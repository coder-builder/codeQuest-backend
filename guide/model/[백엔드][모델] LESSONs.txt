================================================================================
                          Lesson ëª¨ë¸ ì™„ì „ ì •ë¦¬
================================================================================

ì‘ì„±ì¼: 2025-11-06
íŒŒì¼: problems/models.py


================================================================================
ğŸ“¦ ëª¨ë¸ ê°œìš”
================================================================================

[ëª©ì ]
ìŠ¤í…Œì´ì§€ ë‚´ ë ˆìŠ¨ (4-5ê°œ ë¬¸ì œë¡œ êµ¬ì„±)
í•˜ë‚˜ì˜ ìŠ¤í…Œì´ì§€ëŠ” ì—¬ëŸ¬ ê°œì˜ ë ˆìŠ¨ìœ¼ë¡œ êµ¬ì„±
ê° ë ˆìŠ¨ì€ ì—¬ëŸ¬ ê°œì˜ ë¬¸ì œë¥¼ í¬í•¨

[ìœ„ì¹˜]
Django App: problems
íŒŒì¼: problems/models.py
í…Œì´ë¸”ëª…: problems_lesson

[íŠ¹ì§•]
- ìˆœì°¨ì  í•™ìŠµ êµ¬ì¡° (order í•„ë“œ)
- ì´ì „ ë ˆìŠ¨ ì™„ë£Œí•´ì•¼ ë‹¤ìŒ ë ˆìŠ¨ ì—´ë¦¼
- ì™„ë£Œí•œ ë ˆìŠ¨ì€ ë³µìŠµ ê°€ëŠ¥
- ìƒíƒœ: locked, available, in_progress, completed
- unique_togetherë¡œ (stage, order) ì¤‘ë³µ ë°©ì§€


================================================================================
ğŸ—‚ï¸ í•„ë“œ êµ¬ì¡°
================================================================================

stage (ForeignKey)
â”œâ”€ ëŒ€ìƒ: Stage
â”œâ”€ on_delete: CASCADE
â”œâ”€ related_name: 'lessons'
â”œâ”€ ì„¤ëª…: ìŠ¤í…Œì´ì§€
â””â”€ ì—­ì°¸ì¡°: stage.lessons.all()

title (CharField)
â”œâ”€ ìµœëŒ€ ê¸¸ì´: 200ì
â”œâ”€ ì„¤ëª…: ë ˆìŠ¨ ì œëª©
â””â”€ ì˜ˆì‹œ: "ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°", "ì¡°ê±´ë¬¸ ê¸°ì´ˆ", "for ë°˜ë³µë¬¸ í™œìš©"

description (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: ë ˆìŠ¨ ì„¤ëª…
â””â”€ ì˜ˆì‹œ: "Pythonì—ì„œ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ê°’ì„ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤"

order (IntegerField)
â”œâ”€ ì„¤ëª…: ìˆœì„œ
â”œâ”€ ì˜ˆì‹œ: 1, 2, 3...
â””â”€ ì •ë ¬ ê¸°ì¤€: ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ì•

created_at (DateTimeField)
â”œâ”€ ìë™ ìƒì„±: auto_now_add=True
â””â”€ ì„¤ëª…: ìƒì„±ì¼

updated_at (DateTimeField)
â”œâ”€ ìë™ ì—…ë°ì´íŠ¸: auto_now=True
â””â”€ ì„¤ëª…: ìˆ˜ì •ì¼


================================================================================
âš™ï¸ Meta ì„¤ì •
================================================================================

ordering = ['stage__world__title', 'stage__order', 'order']
â”œâ”€ ì •ë ¬ ìš°ì„ ìˆœìœ„:
â”‚   1. ì›”ë“œ ì œëª© (ì•ŒíŒŒë²³ìˆœ)
â”‚   2. ìŠ¤í…Œì´ì§€ ìˆœì„œ
â”‚   3. ë ˆìŠ¨ ìˆœì„œ
â””â”€ ì˜ˆì‹œ: Java Stage1 Lesson1 â†’ Java Stage1 Lesson2 â†’ Python Stage1 Lesson1

verbose_name = "ë ˆìŠ¨"
verbose_name_plural = "ë ˆìŠ¨ ëª©ë¡"

unique_together = (('stage', 'order'),)
â”œâ”€ ì œì•½ì¡°ê±´: (ìŠ¤í…Œì´ì§€, ìˆœì„œ) ì¡°í•© ìœ ì¼
â””â”€ íš¨ê³¼: í•œ ìŠ¤í…Œì´ì§€ ë‚´ì—ì„œ ê°™ì€ order ë²ˆí˜¸ ì¤‘ë³µ ë¶ˆê°€


================================================================================
ğŸ”§ ë©”ì„œë“œ (Methods)
================================================================================

[ë©”ì„œë“œ] get_status_for_user(user)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ì‚¬ìš©ìì—ê²Œ ì´ ë ˆìŠ¨ì˜ ìƒíƒœ ë°˜í™˜
ë§¤ê°œë³€ìˆ˜: user (User ê°ì²´)
ë°˜í™˜: str ('locked', 'available', 'in_progress', 'completed')
ìë™ ì‹¤í–‰: âŒ (ëª…ì‹œì  í˜¸ì¶œ í•„ìš”!)

êµ¬í˜„:
    def get_status_for_user(self, user):
        # 1. ì´ì „ ë ˆìŠ¨ ì™„ë£Œ í™•ì¸
        if not self.is_unlocked_for_user(user):
            return 'locked'
        
        # 2. ì§„í–‰ ìƒí™© í™•ì¸
        try:
            progress = UserLessonProgress.objects.get(
                user=user,
                lesson=self
            )
            
            # ì™„ë£Œë¨
            if progress.is_completed:
                return 'completed'
            
            # ì§„í–‰ ì¤‘
            if progress.is_in_progress:
                return 'in_progress'
            
            # ì‹œì‘ ê°€ëŠ¥ (ê¸°ë¡ì€ ìˆì§€ë§Œ ì§„í–‰ ì•ˆ í•¨)
            return 'available'
            
        except UserLessonProgress.DoesNotExist:
            # ê¸°ë¡ ì—†ìŒ = ì‹œì‘ ê°€ëŠ¥
            return 'available'

ë™ì‘ íë¦„:
    1. is_unlocked_for_user() í˜¸ì¶œ
       â†’ Falseë©´ 'locked' ë°˜í™˜
       â†’ Trueë©´ ë‹¤ìŒ ë‹¨ê³„
    
    2. UserLessonProgress ì¡°íšŒ
       â†’ ì—†ìœ¼ë©´: 'available'
       â†’ ìˆìœ¼ë©´: ë‹¤ìŒ ë‹¨ê³„
    
    3. is_completed í™•ì¸
       â†’ True: 'completed'
       â†’ False: ë‹¤ìŒ ë‹¨ê³„
    
    4. is_in_progress í™•ì¸
       â†’ True: 'in_progress'
       â†’ False: 'available'

ë°˜í™˜ ê°’ ì˜ë¯¸:
    'locked': ğŸ”’ ì ê¹€ (ì´ì „ ë ˆìŠ¨ ë¯¸ì™„ë£Œ)
    'available': ğŸ†• ì‹œì‘ ê°€ëŠ¥
    'in_progress': â³ ì§„í–‰ ì¤‘ (ì´ì–´ì„œ í•˜ê¸°)
    'completed': âœ… ì™„ë£Œ (ë³µìŠµ ê°€ëŠ¥)

ì‚¬ìš© ì˜ˆì‹œ:
    lesson = Lesson.objects.get(id=1)
    status = lesson.get_status_for_user(request.user)
    
    if status == 'locked':
        return Response({'error': 'ì´ì „ ë ˆìŠ¨ ì™„ë£Œ í•„ìš”'}, status=403)
    elif status == 'available':
        # ì‹œì‘í•˜ê¸° ë²„íŠ¼
    elif status == 'in_progress':
        # ì´ì–´ì„œ í•˜ê¸° ë²„íŠ¼
    elif status == 'completed':
        # ë‹¤ì‹œ í’€ê¸° ë²„íŠ¼


[ë©”ì„œë“œ] is_unlocked_for_user(user)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ì´ì „ ë ˆìŠ¨ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
ë§¤ê°œë³€ìˆ˜: user (User ê°ì²´)
ë°˜í™˜: bool
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def is_unlocked_for_user(self, user):
        # ì²« ë²ˆì§¸ ë ˆìŠ¨ì€ í•­ìƒ ì—´ë¦¼
        if self.order == 1:
            return True

        # ì´ì „ ë ˆìŠ¨ ê°€ì ¸ì˜¤ê¸°
        prev_lesson = Lesson.objects.filter(
            stage=self.stage,
            order=self.order - 1
        ).first()

        if not prev_lesson:
            return True

        # ì´ì „ ë ˆìŠ¨ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
        try:
            progress = UserLessonProgress.objects.get(
                user=user,
                lesson=prev_lesson
            )
            return progress.is_completed
        except UserLessonProgress.DoesNotExist:
            return False

ë™ì‘ íë¦„:
    1. order == 1 í™•ì¸
       â†’ True: ì²« ë ˆìŠ¨ì€ í•­ìƒ ì—´ë¦¼
    
    2. ì´ì „ ë ˆìŠ¨ ì¡°íšŒ (order - 1)
       â†’ ì—†ìœ¼ë©´: True (ì•ˆì „ì¥ì¹˜)
    
    3. UserLessonProgress ì¡°íšŒ
       â†’ ì—†ìœ¼ë©´: False
       â†’ ìˆìœ¼ë©´: is_completed ë°˜í™˜

ì‚¬ìš© ì˜ˆì‹œ:
    lesson = Lesson.objects.get(id=2)
    if lesson.is_unlocked_for_user(user):
        # ì ‘ê·¼ í—ˆìš©
    else:
        # ì´ì „ ë ˆìŠ¨ ì™„ë£Œ í•„ìš”


[ë©”ì„œë“œ] can_restart(user)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë ˆìŠ¨ì„ ë³µìŠµí•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
ë§¤ê°œë³€ìˆ˜: user (User ê°ì²´)
ë°˜í™˜: bool
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def can_restart(self, user):
        try:
            progress = UserLessonProgress.objects.get(
                user=user,
                lesson=self
            )
            return progress.is_completed
        except UserLessonProgress.DoesNotExist:
            return False

ë™ì‘:
    UserLessonProgress ì¡°íšŒ â†’ is_completed ë°˜í™˜
    ì—†ìœ¼ë©´ False

ì‚¬ìš© ì‹œì :
    âœ“ "ë‹¤ì‹œ í’€ê¸°" ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
    âœ“ ë³µìŠµ ê¸°ëŠ¥ í™œì„±í™”

ì‚¬ìš© ì˜ˆì‹œ:
    lesson = Lesson.objects.get(id=1)
    if lesson.can_restart(user):
        # ë‹¤ì‹œ í’€ê¸° ë²„íŠ¼ í‘œì‹œ
    else:
        # ë²„íŠ¼ ìˆ¨ê¹€


[ë©”ì„œë“œ] get_progress_info(user)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë ˆìŠ¨ì˜ ëª¨ë“  ì§„í–‰ ì •ë³´ë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë°˜í™˜
ë§¤ê°œë³€ìˆ˜: user (User ê°ì²´)
ë°˜í™˜: dict
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def get_progress_info(self, user):
        status = self.get_status_for_user(user)
        
        result = {
            'lesson_id': self.id,
            'title': self.title,
            'description': self.description,
            'order': self.order,
            'status': status,
            'is_locked': status == 'locked',
            'can_start': status in ['available', 'completed'],
            'can_continue': status == 'in_progress',
            'can_restart': status == 'completed',
        }
        
        # ì§„í–‰ ì¤‘ì´ê±°ë‚˜ ì™„ë£Œëœ ê²½ìš° ìƒì„¸ ì •ë³´ ì¶”ê°€
        if status in ['in_progress', 'completed']:
            try:
                progress = UserLessonProgress.objects.get(
                    user=user,
                    lesson=self
                )
                result.update({
                    'current_round': progress.current_round,
                    'completed_problems': progress.completed_problems_count,
                    'total_problems': progress.total_problems,
                    'progress_percentage': int(
                        (progress.completed_problems_count / progress.total_problems * 100)
                        if progress.total_problems > 0 else 0
                    ),
                    'started_at': progress.started_at,
                    'completed_at': progress.completed_at if status == 'completed' else None,
                    'abandon_count': progress.abandon_count,
                })
            except UserLessonProgress.DoesNotExist:
                pass
        
        return result

ë°˜í™˜ ë°ì´í„° êµ¬ì¡°:
    ê¸°ë³¸ ì •ë³´ (í•­ìƒ):
    {
        'lesson_id': 1,
        'title': 'ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°',
        'description': '...',
        'order': 1,
        'status': 'in_progress',
        'is_locked': False,
        'can_start': False,
        'can_continue': True,
        'can_restart': False
    }
    
    ì§„í–‰ ì¤‘/ì™„ë£Œ ì‹œ ì¶”ê°€:
    {
        'current_round': 2,
        'completed_problems': 3,
        'total_problems': 5,
        'progress_percentage': 60,
        'started_at': '2025-11-04T10:00:00Z',
        'completed_at': None,  # ë˜ëŠ” ì‹œê°„
        'abandon_count': 1
    }

ì‚¬ìš© ì‹œì :
    âœ“ ë ˆìŠ¨ ìƒì„¸ í™”ë©´
    âœ“ ë ˆìŠ¨ ëª©ë¡ (ê° ë ˆìŠ¨ì˜ ìƒíƒœ í‘œì‹œ)
    âœ“ API ì‘ë‹µ

ì‚¬ìš© ì˜ˆì‹œ:
    lesson = Lesson.objects.get(id=1)
    info = lesson.get_progress_info(request.user)
    return Response(info)


[ë©”ì„œë“œ] __str__()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë¬¸ìì—´ í‘œí˜„
ë°˜í™˜: f"{self.stage.title} - Lesson {self.order}: {self.title}"
ì˜ˆì‹œ: "ë³€ìˆ˜ì™€ ì¶œë ¥ - Lesson 1: ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°"


================================================================================
ğŸ”— ê´€ê³„ (Relationships)
================================================================================

[Forward Relation]
lesson.stage
â”œâ”€ ì ‘ê·¼: lesson.stage
â”œâ”€ íƒ€ì…: Stage ê°ì²´
â””â”€ ì˜ˆì‹œ: lesson.stage.title â†’ "ë³€ìˆ˜ì™€ ì¶œë ¥"

[Reverse Relations]
lesson.problems
â”œâ”€ related_name: problems
â”œâ”€ ì ‘ê·¼: lesson.problems.all()
â”œâ”€ ì„¤ëª…: ì´ ë ˆìŠ¨ì— ì†í•œ ëª¨ë“  ë¬¸ì œ
â””â”€ ì˜ˆì‹œ:
    lesson = Lesson.objects.get(id=1)
    problems = lesson.problems.all()


================================================================================
ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°
================================================================================

CREATE TABLE problems_lesson (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    stage_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    `order` INT NOT NULL,
    created_at DATETIME(6) NOT NULL,
    updated_at DATETIME(6) NOT NULL,
    UNIQUE KEY unique_stage_order (stage_id, `order`),
    FOREIGN KEY (stage_id) REFERENCES worlds_stage(id)
);


================================================================================
ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ
================================================================================

[1. Lesson ìƒì„±]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stage = Stage.objects.get(id=1)

lesson1 = Lesson.objects.create(
    stage=stage,
    title='ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°',
    description='Pythonì—ì„œ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ê°’ì„ ì €ì¥í•˜ëŠ” ë°©ë²•',
    order=1
)


[2. ë ˆìŠ¨ ìƒíƒœ í™•ì¸]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
lesson = Lesson.objects.get(id=1)
status = lesson.get_status_for_user(request.user)

if status == 'locked':
    print("ğŸ”’ ì ê¹€")
elif status == 'available':
    print("ğŸ†• ì‹œì‘ ê°€ëŠ¥")
elif status == 'in_progress':
    print("â³ ì§„í–‰ ì¤‘")
elif status == 'completed':
    print("âœ… ì™„ë£Œ")


[3. ë ˆìŠ¨ ëª©ë¡ (ìƒíƒœ í¬í•¨)]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stage = Stage.objects.get(id=1)
lessons = stage.lessons.all()

result = []
for lesson in lessons:
    info = lesson.get_progress_info(request.user)
    result.append(info)


[4. ë ˆìŠ¨ ì‹œì‘í•˜ê¸°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
lesson = Lesson.objects.get(id=1)
status = lesson.get_status_for_user(user)

if status == 'locked':
    raise PermissionError("ì´ì „ ë ˆìŠ¨ ì™„ë£Œ í•„ìš”")

# ì§„í–‰ ìƒí™© ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°
progress, created = UserLessonProgress.objects.get_or_create(
    user=user,
    lesson=lesson
)

# ë³µìŠµì´ë©´ ì´ˆê¸°í™”
if status == 'completed':
    progress.reset_progress()

# 1ë¼ìš´ë“œ ì‹œì‘
progress.initialize_round_one()


================================================================================
ğŸŒ API Serializer ì˜ˆì‹œ
================================================================================

# problems/serializers.py

from rest_framework import serializers
from .models import Lesson

class LessonSerializer(serializers.ModelSerializer):
    stage_title = serializers.CharField(source='stage.title', read_only=True)
    problem_count = serializers.SerializerMethodField()
    status = serializers.SerializerMethodField()
    progress_info = serializers.SerializerMethodField()
    
    class Meta:
        model = Lesson
        fields = [
            'id',
            'stage',
            'stage_title',
            'title',
            'description',
            'order',
            'problem_count',
            'status',
            'progress_info',
            'created_at',
            'updated_at'
        ]
        read_only_fields = ['created_at', 'updated_at']
    
    def get_problem_count(self, obj):
        """ë¬¸ì œ ê°œìˆ˜"""
        return obj.problems.count()
    
    def get_status(self, obj):
        """ë ˆìŠ¨ ìƒíƒœ"""
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            return obj.get_status_for_user(request.user)
        return 'locked'
    
    def get_progress_info(self, obj):
        """ì§„í–‰ ì •ë³´"""
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            return obj.get_progress_info(request.user)
        return {}


[API ì‘ë‹µ ì˜ˆì‹œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
    "id": 1,
    "stage": 1,
    "stage_title": "ë³€ìˆ˜ì™€ ì¶œë ¥",
    "title": "ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°",
    "description": "Pythonì—ì„œ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ê°’ì„ ì €ì¥í•˜ëŠ” ë°©ë²•",
    "order": 1,
    "problem_count": 5,
    "status": "in_progress",
    "progress_info": {
        "lesson_id": 1,
        "title": "ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°",
        "order": 1,
        "status": "in_progress",
        "is_locked": false,
        "can_start": false,
        "can_continue": true,
        "can_restart": false,
        "current_round": 2,
        "completed_problems": 3,
        "total_problems": 5,
        "progress_percentage": 60,
        "started_at": "2025-11-04T10:00:00Z",
        "abandon_count": 0
    },
    "created_at": "2025-11-01T10:00:00Z",
    "updated_at": "2025-11-04T14:30:00Z"
}


================================================================================
ğŸ® ì‹¤ì „ í™œìš© ì‹œë‚˜ë¦¬ì˜¤
================================================================================

[ì‹œë‚˜ë¦¬ì˜¤ 1: ë ˆìŠ¨ ëª©ë¡ API]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['GET'])
def lesson_list(request, stage_id):
    """ìŠ¤í…Œì´ì§€ì˜ ë ˆìŠ¨ ëª©ë¡ (ìƒíƒœ í¬í•¨)"""
    lessons = Lesson.objects.filter(stage_id=stage_id)
    
    serializer = LessonSerializer(
        lessons,
        many=True,
        context={'request': request}
    )
    return Response(serializer.data)


[ì‹œë‚˜ë¦¬ì˜¤ 2: ë ˆìŠ¨ ìƒì„¸ + ë¬¸ì œ ëª©ë¡]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['GET'])
def lesson_detail(request, lesson_id):
    """ë ˆìŠ¨ ìƒì„¸ + ì ‘ê·¼ ê¶Œí•œ í™•ì¸"""
    lesson = Lesson.objects.get(id=lesson_id)
    
    # ìƒíƒœ í™•ì¸
    status = lesson.get_status_for_user(request.user)
    
    if status == 'locked':
        return Response({
            'error': 'ì´ì „ ë ˆìŠ¨ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!'
        }, status=403)
    
    # ë ˆìŠ¨ ì •ë³´ + ë¬¸ì œ ëª©ë¡
    return Response({
        'lesson': LessonSerializer(lesson, context={'request': request}).data,
        'problems': ProblemSerializer(lesson.problems.all(), many=True).data
    })


[ì‹œë‚˜ë¦¬ì˜¤ 3: ë ˆìŠ¨ ì‹œì‘í•˜ê¸°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['POST'])
def start_lesson(request, lesson_id):
    """ë ˆìŠ¨ ì‹œì‘í•˜ê¸°"""
    lesson = Lesson.objects.get(id=lesson_id)
    user = request.user
    
    # ìƒíƒœ í™•ì¸
    status = lesson.get_status_for_user(user)
    
    if status == 'locked':
        return Response({'error': 'ì´ì „ ë ˆìŠ¨ ì™„ë£Œ í•„ìš”'}, status=403)
    
    if status == 'in_progress':
        return Response({'error': 'ì´ë¯¸ ì§„í–‰ ì¤‘. ì´ì–´í•˜ê¸° ì‚¬ìš©'}, status=400)
    
    # ì§„í–‰ ìƒí™© ìƒì„±
    progress, created = UserLessonProgress.objects.get_or_create(
        user=user,
        lesson=lesson
    )
    
    # ë³µìŠµì´ë©´ ì´ˆê¸°í™”
    if status == 'completed':
        progress.reset_progress()
    
    # 1ë¼ìš´ë“œ ì´ˆê¸°í™”
    progress.initialize_round_one()
    progress.started_at = timezone.now()
    progress.save()
    
    # ì²« ë¬¸ì œ
    current_problem = progress.get_current_problem()
    
    return Response({
        'message': 'ë³µìŠµ ì‹œì‘!' if status == 'completed' else 'ë ˆìŠ¨ ì‹œì‘!',
        'progress': UserLessonProgressSerializer(progress).data,
        'current_problem': ProblemSerializer(current_problem).data
    })


[ì‹œë‚˜ë¦¬ì˜¤ 4: ë ˆìŠ¨ ì´ì–´í•˜ê¸°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['POST'])
def continue_lesson(request, lesson_id):
    """ë ˆìŠ¨ ì´ì–´í•˜ê¸°"""
    lesson = Lesson.objects.get(id=lesson_id)
    
    status = lesson.get_status_for_user(request.user)
    
    if status != 'in_progress':
        return Response({'error': 'ì§„í–‰ ì¤‘ì¸ ë ˆìŠ¨ ì•„ë‹˜'}, status=400)
    
    progress = UserLessonProgress.objects.get(
        user=request.user,
        lesson=lesson
    )
    
    current_problem = progress.get_current_problem()
    
    return Response({
        'message': 'ì´ì–´ì„œ ì‹œì‘!',
        'progress': {
            'current_round': progress.current_round,
            'completed': progress.completed_problems_count,
            'total': progress.total_problems,
            'percentage': int(
                (progress.completed_problems_count / progress.total_problems * 100)
                if progress.total_problems > 0 else 0
            )
        },
        'current_problem': ProblemSerializer(current_problem).data
    })


================================================================================
âš ï¸ ì£¼ì˜ì‚¬í•­
================================================================================

[1. ë©”ì„œë“œ ìë™ ì‹¤í–‰ ì•ˆ ë¨]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ ëª¨ë“  ë©”ì„œë“œëŠ” ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•¨!

ì˜ëª»ëœ ì˜ˆ:
    lesson = Lesson.objects.get(id=1)
    # â†’ ìƒíƒœ ìë™ í™•ì¸ ì•ˆ ë¨!

ì˜¬ë°”ë¥¸ ì˜ˆ:
    lesson = Lesson.objects.get(id=1)
    status = lesson.get_status_for_user(user)  # âœ…


[2. N+1 ì¿¼ë¦¬ ì£¼ì˜]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ N+1 ì¿¼ë¦¬:
    lessons = Lesson.objects.all()
    for lesson in lessons:
        status = lesson.get_status_for_user(user)  # ê°ê° ì¿¼ë¦¬!

âœ… ìµœì í™” ì–´ë ¤ì›€ (ë³µì¡í•œ ë¡œì§)
    â†’ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ê°œìˆ˜ ì œí•œ ê¶Œì¥


[3. unique_together ì œì•½]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê°™ì€ ìŠ¤í…Œì´ì§€ ë‚´ì—ì„œ ê°™ì€ order ë²ˆí˜¸ ì¤‘ë³µ ë¶ˆê°€

âŒ IntegrityError:
    Lesson.objects.create(stage=stage1, order=1, title="A")
    Lesson.objects.create(stage=stage1, order=1, title="B")


[4. CASCADE ì‚­ì œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Lesson ì‚­ì œ ì‹œ ê´€ë ¨ëœ ëª¨ë“  ë°ì´í„° ì‚­ì œ:
âœ— Problem
âœ— UserLessonProgress
âœ— ProblemAttempt


================================================================================
ğŸ“ ë°ì´í„° ì˜ˆì‹œ
================================================================================

[Stage 1: ë³€ìˆ˜ì™€ ì¶œë ¥ - ë ˆìŠ¨ ìƒ˜í”Œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Lesson 1: ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°
  - ë¬¸ì œ 5ê°œ

Lesson 2: ë³€ìˆ˜ ê³„ì‚°í•˜ê¸°
  - ë¬¸ì œ 5ê°œ

Lesson 3: print() í•¨ìˆ˜
  - ë¬¸ì œ 4ê°œ

Lesson 4: ë¬¸ìì—´ ì¶œë ¥
  - ë¬¸ì œ 5ê°œ

Lesson 5: ì¢…í•© ë¬¸ì œ
  - ë¬¸ì œ 6ê°œ


================================================================================
ğŸ”— ê´€ë ¨ ëª¨ë¸ ë§í¬
================================================================================

â†’ Stage: ìŠ¤í…Œì´ì§€ ì •ë³´
â†’ Problem: ë ˆìŠ¨ ë‚´ ë¬¸ì œ
â†’ UserLessonProgress: ì‚¬ìš©ìë³„ ë ˆìŠ¨ ì§„í–‰ ìƒí™©


================================================================================
ë!
================================================================================
