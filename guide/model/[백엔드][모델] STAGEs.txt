================================================================================
                          Stage ëª¨ë¸ ì™„ì „ ì •ë¦¬
================================================================================

ì‘ì„±ì¼: 2025-11-06
íŒŒì¼: worlds/models.py


================================================================================
ğŸ“¦ ëª¨ë¸ ê°œìš”
================================================================================

[ëª©ì ]
ì›”ë“œ ë‚´ ìŠ¤í…Œì´ì§€ (í•™ìŠµ ì£¼ì œ/ì±•í„°)
í•˜ë‚˜ì˜ ì›”ë“œëŠ” ì—¬ëŸ¬ ê°œì˜ ìŠ¤í…Œì´ì§€ë¡œ êµ¬ì„±
ì˜ˆ: Python ì›”ë“œ â†’ Stage 1: ë³€ìˆ˜, Stage 2: ì¡°ê±´ë¬¸, Stage 3: ë°˜ë³µë¬¸...

[ìœ„ì¹˜]
Django App: worlds
íŒŒì¼: worlds/models.py
í…Œì´ë¸”ëª…: worlds_stage

[íŠ¹ì§•]
- ìˆœì°¨ì  í•™ìŠµ êµ¬ì¡° (order í•„ë“œ)
- ì´ì „ ìŠ¤í…Œì´ì§€ ì™„ë£Œí•´ì•¼ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ì—´ë¦¼
- unique_togetherë¡œ (world, order) ì¤‘ë³µ ë°©ì§€


================================================================================
ğŸ—‚ï¸ í•„ë“œ êµ¬ì¡°
================================================================================

world (ForeignKey)
â”œâ”€ ëŒ€ìƒ: World
â”œâ”€ on_delete: CASCADE
â”œâ”€ related_name: 'stages'
â”œâ”€ ì„¤ëª…: ì›”ë“œ
â””â”€ ì—­ì°¸ì¡°: world.stages.all()

title (CharField)
â”œâ”€ ìµœëŒ€ ê¸¸ì´: 100ì
â”œâ”€ ì„¤ëª…: ìŠ¤í…Œì´ì§€ ì œëª©
â””â”€ ì˜ˆì‹œ: "ë³€ìˆ˜ì™€ ì¶œë ¥", "ì¡°ê±´ë¬¸ if", "ë°˜ë³µë¬¸ for"

description (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: ìŠ¤í…Œì´ì§€ ì„¤ëª…
â””â”€ ì˜ˆì‹œ: "Pythonì˜ ë³€ìˆ˜ ì„ ì–¸ê³¼ ì¶œë ¥ ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤"

order (IntegerField)
â”œâ”€ ì„¤ëª…: ìˆœì„œ
â”œâ”€ ì˜ˆì‹œ: 1, 2, 3...
â””â”€ ì •ë ¬ ê¸°ì¤€: ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ì•

created_at (DateTimeField)
â”œâ”€ ìë™ ìƒì„±: auto_now_add=True
â””â”€ ì„¤ëª…: ìƒì„±ì¼

updated_at (DateTimeField)
â”œâ”€ ìë™ ì—…ë°ì´íŠ¸: auto_now=True
â””â”€ ì„¤ëª…: ìˆ˜ì •ì¼


================================================================================
âš™ï¸ Meta ì„¤ì •
================================================================================

ordering = ['order']
â”œâ”€ ì •ë ¬ ê¸°ì¤€: order ì˜¤ë¦„ì°¨ìˆœ
â””â”€ ì˜ˆì‹œ: Stage 1 â†’ Stage 2 â†’ Stage 3

verbose_name = "ìŠ¤í…Œì´ì§€"
verbose_name_plural = "ìŠ¤í…Œì´ì§€ ëª©ë¡"

unique_together = (('world', 'order'),)
â”œâ”€ ì œì•½ì¡°ê±´: (ì›”ë“œ, ìˆœì„œ) ì¡°í•© ìœ ì¼
â””â”€ íš¨ê³¼: í•œ ì›”ë“œ ë‚´ì—ì„œ ê°™ì€ order ë²ˆí˜¸ ì¤‘ë³µ ë¶ˆê°€


================================================================================
ğŸ”§ ë©”ì„œë“œ (Methods)
================================================================================

[ë©”ì„œë“œ] is_unlocked_for_user(user)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ì´ì „ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì—¬ ì ê¸ˆ í•´ì œ ì—¬ë¶€ ë°˜í™˜
ë§¤ê°œë³€ìˆ˜: user (User ê°ì²´)
ë°˜í™˜: bool (True: ì ê¸ˆ í•´ì œ, False: ì ê¹€)
ìë™ ì‹¤í–‰: âŒ (ëª…ì‹œì  í˜¸ì¶œ í•„ìš”!)

êµ¬í˜„:
    def is_unlocked_for_user(self, user):
        # ì²« ë²ˆì§¸ ìŠ¤í…Œì´ì§€ëŠ” í•­ìƒ ì—´ë¦¼
        if self.order == 1:
            return True

        # ì´ì „ ìŠ¤í…Œì´ì§€ ê°€ì ¸ì˜¤ê¸°
        prev_stage = Stage.objects.filter(
            world=self.world,
            order=self.order - 1,
        ).first()

        # ì´ì „ ìŠ¤í…Œì´ì§€ê°€ ì—†ìœ¼ë©´ ì—´ë¦¼ (ì•ˆì „ì¥ì¹˜)
        if not prev_stage:
            return True

        # ì´ì „ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
        try:
            progress = UserStageProgress.objects.get(
                user=user,
                stage=prev_stage,
            )
            return progress.is_completed
        except UserStageProgress.DoesNotExist:
            return False

ë™ì‘ íë¦„:
    1. order == 1 í™•ì¸
       â†’ True: ì²« ìŠ¤í…Œì´ì§€ëŠ” í•­ìƒ ì—´ë¦¼
       â†’ False: ë‹¤ìŒ ë‹¨ê³„ë¡œ
    
    2. ì´ì „ ìŠ¤í…Œì´ì§€ ì¡°íšŒ (order - 1)
       â†’ ì—†ìœ¼ë©´: True (ë°ì´í„° ë¬¸ì œ ë°©ì§€)
       â†’ ìˆìœ¼ë©´: ë‹¤ìŒ ë‹¨ê³„ë¡œ
    
    3. UserStageProgress ì¡°íšŒ
       â†’ ì—†ìœ¼ë©´: False (ì‹œì‘ë„ ì•ˆ í•¨)
       â†’ ìˆìœ¼ë©´: is_completed ë°˜í™˜

ë°˜í™˜ ê°’ ì˜ë¯¸:
    True: ì´ ìŠ¤í…Œì´ì§€ì— ì ‘ê·¼ ê°€ëŠ¥
    False: ì´ì „ ìŠ¤í…Œì´ì§€ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì•¼ í•¨

í˜¸ì¶œ ì‹œì :
    âœ“ ìŠ¤í…Œì´ì§€ ì§„ì… ì „ ê¶Œí•œ í™•ì¸
    âœ“ ìŠ¤í…Œì´ì§€ ëª©ë¡ í‘œì‹œ ì‹œ ì ê¸ˆ ìƒíƒœ í‘œì‹œ
    âœ“ API ìš”ì²­ ì‹œ ê¶Œí•œ ê²€ì¦

ì£¼ì˜ì‚¬í•­:
    âš ï¸ ë§¤ë²ˆ DB ì¿¼ë¦¬ ë°œìƒ (UserStageProgress ì¡°íšŒ)
    âš ï¸ ì—¬ëŸ¬ ìŠ¤í…Œì´ì§€ í™•ì¸ ì‹œ N+1 ì¿¼ë¦¬ ì£¼ì˜


[ë©”ì„œë“œ] __str__()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë¬¸ìì—´ í‘œí˜„
ë°˜í™˜: f"{self.world.title} - Stage {self.order}: {self.title}"
ì˜ˆì‹œ: 
    "Python - Stage 1: ë³€ìˆ˜ì™€ ì¶œë ¥"
    "Java - Stage 3: ë°˜ë³µë¬¸"


================================================================================
ğŸ”— ê´€ê³„ (Relationships)
================================================================================

[Forward Relation]
stage.world
â”œâ”€ ì ‘ê·¼: stage.world
â”œâ”€ íƒ€ì…: World ê°ì²´
â””â”€ ì˜ˆì‹œ: stage.world.title â†’ "Python"

[Reverse Relations]
stage.lessons
â”œâ”€ related_name: lessons
â”œâ”€ ì ‘ê·¼: stage.lessons.all()
â”œâ”€ ì„¤ëª…: ì´ ìŠ¤í…Œì´ì§€ì— ì†í•œ ëª¨ë“  ë ˆìŠ¨
â””â”€ ì˜ˆì‹œ:
    stage = Stage.objects.get(id=1)
    lessons = stage.lessons.all()  # ì´ ìŠ¤í…Œì´ì§€ì˜ ëª¨ë“  ë ˆìŠ¨


================================================================================
ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°
================================================================================

CREATE TABLE worlds_stage (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    world_id BIGINT NOT NULL,
    title VARCHAR(100) NOT NULL,
    description TEXT,
    `order` INT NOT NULL,
    created_at DATETIME(6) NOT NULL,
    updated_at DATETIME(6) NOT NULL,
    UNIQUE KEY unique_world_order (world_id, `order`),
    FOREIGN KEY (world_id) REFERENCES worlds_world(id)
);


================================================================================
ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ
================================================================================

[1. Stage ìƒì„±]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
python = World.objects.get(title='Python')

stage1 = Stage.objects.create(
    world=python,
    title='ë³€ìˆ˜ì™€ ì¶œë ¥',
    description='Pythonì˜ ë³€ìˆ˜ ì„ ì–¸ê³¼ print() í•¨ìˆ˜ë¥¼ ë°°ì›ë‹ˆë‹¤',
    order=1
)

stage2 = Stage.objects.create(
    world=python,
    title='ì¡°ê±´ë¬¸ if',
    description='if, elif, elseë¥¼ ì‚¬ìš©í•œ ì¡°ê±´ ë¶„ê¸°ë¥¼ ë°°ì›ë‹ˆë‹¤',
    order=2
)


[2. ì ê¸ˆ ìƒíƒœ í™•ì¸]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
stage2 = Stage.objects.get(id=2)

if stage2.is_unlocked_for_user(request.user):
    print("Stage 2ì— ì ‘ê·¼ ê°€ëŠ¥!")
else:
    print("Stage 1ì„ ë¨¼ì € ì™„ë£Œí•˜ì„¸ìš”")


[3. ì›”ë“œì˜ ëª¨ë“  ìŠ¤í…Œì´ì§€ ì¡°íšŒ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
python = World.objects.get(title='Python')
stages = python.stages.all()  # order ìˆœìœ¼ë¡œ ì •ë ¬ë¨

for stage in stages:
    print(f"{stage.order}. {stage.title}")
    # 1. ë³€ìˆ˜ì™€ ì¶œë ¥
    # 2. ì¡°ê±´ë¬¸ if
    # 3. ë°˜ë³µë¬¸ for


[4. ìŠ¤í…Œì´ì§€ë³„ ì ê¸ˆ ìƒíƒœ í™•ì¸ (ì „ì²´)]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
python = World.objects.get(title='Python')
stages = python.stages.all()

for stage in stages:
    is_unlocked = stage.is_unlocked_for_user(request.user)
    status = "ğŸ”“" if is_unlocked else "ğŸ”’"
    print(f"{status} Stage {stage.order}: {stage.title}")


[5. ë‹¤ìŒ ìŠ¤í…Œì´ì§€ ì°¾ê¸°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
current_stage = Stage.objects.get(id=1)

next_stage = Stage.objects.filter(
    world=current_stage.world,
    order=current_stage.order + 1
).first()

if next_stage:
    print(f"ë‹¤ìŒ: {next_stage.title}")
else:
    print("ë§ˆì§€ë§‰ ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤")


================================================================================
ğŸŒ API Serializer ì˜ˆì‹œ
================================================================================

# worlds/serializers.py

from rest_framework import serializers
from .models import Stage

class StageSerializer(serializers.ModelSerializer):
    world_title = serializers.CharField(source='world.title', read_only=True)
    lesson_count = serializers.SerializerMethodField()
    is_unlocked = serializers.SerializerMethodField()
    
    class Meta:
        model = Stage
        fields = [
            'id',
            'world',
            'world_title',
            'title',
            'description',
            'order',
            'lesson_count',
            'is_unlocked',
            'created_at',
            'updated_at'
        ]
        read_only_fields = ['created_at', 'updated_at']
    
    def get_lesson_count(self, obj):
        """ë ˆìŠ¨ ê°œìˆ˜"""
        return obj.lessons.count()
    
    def get_is_unlocked(self, obj):
        """ì ê¸ˆ í•´ì œ ì—¬ë¶€"""
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            return obj.is_unlocked_for_user(request.user)
        return False


[API ì‘ë‹µ ì˜ˆì‹œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
    "id": 1,
    "world": 1,
    "world_title": "Python",
    "title": "ë³€ìˆ˜ì™€ ì¶œë ¥",
    "description": "Pythonì˜ ë³€ìˆ˜ ì„ ì–¸ê³¼ print() í•¨ìˆ˜ë¥¼ ë°°ì›ë‹ˆë‹¤",
    "order": 1,
    "lesson_count": 5,
    "is_unlocked": true,
    "created_at": "2025-11-01T10:00:00Z",
    "updated_at": "2025-11-01T10:00:00Z"
}


================================================================================
ğŸ® ì‹¤ì „ í™œìš© ì‹œë‚˜ë¦¬ì˜¤
================================================================================

[ì‹œë‚˜ë¦¬ì˜¤ 1: ìŠ¤í…Œì´ì§€ ëª©ë¡ API (ì ê¸ˆ ìƒíƒœ í¬í•¨)]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['GET'])
def stage_list(request, world_id):
    """ì›”ë“œì˜ ìŠ¤í…Œì´ì§€ ëª©ë¡ (ì ê¸ˆ ìƒíƒœ í¬í•¨)"""
    stages = Stage.objects.filter(world_id=world_id)
    
    serializer = StageSerializer(
        stages,
        many=True,
        context={'request': request}
    )
    return Response(serializer.data)


[ì‹œë‚˜ë¦¬ì˜¤ 2: ìŠ¤í…Œì´ì§€ ì§„ì… ê¶Œí•œ í™•ì¸]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['GET'])
def stage_detail(request, stage_id):
    """ìŠ¤í…Œì´ì§€ ìƒì„¸ + ì ‘ê·¼ ê¶Œí•œ í™•ì¸"""
    stage = Stage.objects.get(id=stage_id)
    
    # ê¶Œí•œ í™•ì¸
    if not stage.is_unlocked_for_user(request.user):
        return Response({
            'error': 'ì´ì „ ìŠ¤í…Œì´ì§€ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!',
            'required_stage': stage.order - 1
        }, status=403)
    
    # ë ˆìŠ¨ ëª©ë¡ í¬í•¨
    return Response({
        'stage': StageSerializer(stage, context={'request': request}).data,
        'lessons': LessonSerializer(stage.lessons.all(), many=True).data
    })


[ì‹œë‚˜ë¦¬ì˜¤ 3: ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²˜ë¦¬]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['POST'])
def complete_stage(request, stage_id):
    """ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²˜ë¦¬"""
    stage = Stage.objects.get(id=stage_id)
    user = request.user
    
    # ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
    progress, created = UserStageProgress.objects.get_or_create(
        user=user,
        stage=stage
    )
    
    progress.is_completed = True
    progress.completed_at = timezone.now()
    progress.save()
    
    # UserWorld ì—…ë°ì´íŠ¸
    user_world = UserWorld.objects.get(user=user, world=stage.world)
    user_world.update_progress()
    user_world.touch()
    
    # ë‹¤ìŒ ìŠ¤í…Œì´ì§€ í™•ì¸
    next_stage = Stage.objects.filter(
        world=stage.world,
        order=stage.order + 1
    ).first()
    
    return Response({
        'message': 'Stage ì™„ë£Œ!',
        'next_stage': StageSerializer(next_stage).data if next_stage else None
    })


[ì‹œë‚˜ë¦¬ì˜¤ 4: ì§„í–‰ ê°€ëŠ¥í•œ ìŠ¤í…Œì´ì§€ ì°¾ê¸°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['GET'])
def current_stage(request, world_id):
    """í˜„ì¬ ì§„í–‰ ê°€ëŠ¥í•œ ìŠ¤í…Œì´ì§€ (ê°€ì¥ ë¹ ë¥¸ ë¯¸ì™„ë£Œ)"""
    stages = Stage.objects.filter(world_id=world_id).order_by('order')
    
    for stage in stages:
        # ì™„ë£Œ í™•ì¸
        progress = UserStageProgress.objects.filter(
            user=request.user,
            stage=stage,
            is_completed=True
        ).exists()
        
        if not progress:
            # ì ê¸ˆ í™•ì¸
            if stage.is_unlocked_for_user(request.user):
                return Response({
                    'current_stage': StageSerializer(
                        stage,
                        context={'request': request}
                    ).data
                })
    
    return Response({'message': 'ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!'})


================================================================================
âš ï¸ ì£¼ì˜ì‚¬í•­
================================================================================

[1. unique_together ì œì•½]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê°™ì€ ì›”ë“œ ë‚´ì—ì„œ ê°™ì€ order ë²ˆí˜¸ ì¤‘ë³µ ë¶ˆê°€

âŒ ì˜¤ë¥˜ ë°œìƒ:
    Stage.objects.create(world=python, order=1, title="A")
    Stage.objects.create(world=python, order=1, title="B")
    # IntegrityError!

âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©:
    Stage.objects.create(world=python, order=1, title="A")
    Stage.objects.create(world=python, order=2, title="B")


[2. is_unlocked_for_user() ìë™ ì‹¤í–‰ ì•ˆ ë¨]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ ìŠ¤í…Œì´ì§€ë¥¼ ì¡°íšŒí•´ë„ ìë™ìœ¼ë¡œ ì ê¸ˆ í™•ì¸ ì•ˆ ë¨!
âš ï¸ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•¨!

ì˜ëª»ëœ ì˜ˆ:
    stage = Stage.objects.get(id=2)
    # â†’ ì ê¸ˆ í™•ì¸ ìë™ ì‹¤í–‰ ì•ˆ ë¨!

ì˜¬ë°”ë¥¸ ì˜ˆ:
    stage = Stage.objects.get(id=2)
    is_unlocked = stage.is_unlocked_for_user(user)  # âœ… ëª…ì‹œì  í˜¸ì¶œ
    
    if not is_unlocked:
        return Response({'error': 'ì ‘ê·¼ ë¶ˆê°€'}, status=403)


[3. N+1 ì¿¼ë¦¬ ì£¼ì˜]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ N+1 ì¿¼ë¦¬ ë°œìƒ:
    stages = Stage.objects.all()
    for stage in stages:
        print(stage.is_unlocked_for_user(user))  # ê°ê° ì¿¼ë¦¬!

âœ… ìµœì í™” (ë³µì¡í•˜ì§€ë§Œ ê°€ëŠ¥):
    # UserStageProgressë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°
    user_progresses = UserStageProgress.objects.filter(
        user=user,
        stage__in=stages
    ).select_related('stage')
    
    progress_dict = {p.stage_id: p.is_completed for p in user_progresses}
    
    # ë©”ëª¨ë¦¬ì—ì„œ í™•ì¸
    for stage in stages:
        if stage.order == 1:
            is_unlocked = True
        else:
            prev_stage_id = ...  # ì´ì „ ìŠ¤í…Œì´ì§€ ID ì°¾ê¸°
            is_unlocked = progress_dict.get(prev_stage_id, False)


[4. order ë³€ê²½ ì‹œ ì£¼ì˜]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Stageì˜ orderë¥¼ ë³€ê²½í•˜ë©´ ì „ì²´ ìˆœì„œê°€ ë°”ë€œ

ì˜ˆì‹œ:
    Stage 1 â†’ Stage 2 â†’ Stage 3
    
    # Stage 2ë¥¼ Stage 1ë¡œ ë³€ê²½í•˜ë©´?
    stage2.order = 1
    stage2.save()
    # â†’ unique_together ìœ„ë°˜! (ê¸°ì¡´ Stage 1ê³¼ ì¶©ëŒ)

í•´ê²°:
    # ìˆœì„œ ë°”ê¾¸ê¸°ëŠ” ë³µì¡í•¨ (ì¼ê´„ ì—…ë°ì´íŠ¸ í•„ìš”)
    # ê°€ê¸‰ì  orderëŠ” ê³ ì •í•˜ê³  ìƒˆë¡œ ì¶”ê°€ë§Œ


[5. CASCADE ì‚­ì œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Stage ì‚­ì œ ì‹œ ê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë¨:
âœ— Lesson (ë ˆìŠ¨)
âœ— Problem (ë¬¸ì œ)
âœ— UserStageProgress (ì‚¬ìš©ì ì§„í–‰ ìƒí™©)
âœ— UserLessonProgress
âœ— ProblemAttempt

â†’ ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” ì‚­ì œë³´ë‹¤ ë¹„í™œì„±í™” ê¶Œì¥


================================================================================
ğŸ“ ë°ì´í„° ì˜ˆì‹œ
================================================================================

[Python ì›”ë“œ ìŠ¤í…Œì´ì§€ ìƒ˜í”Œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Stage 1: ë³€ìˆ˜ì™€ ì¶œë ¥
  - Pythonì˜ ë³€ìˆ˜ ì„ ì–¸ê³¼ print() í•¨ìˆ˜
  - ë ˆìŠ¨ 5ê°œ

Stage 2: ì¡°ê±´ë¬¸ if
  - if, elif, elseë¥¼ ì‚¬ìš©í•œ ì¡°ê±´ ë¶„ê¸°
  - ë ˆìŠ¨ 6ê°œ

Stage 3: ë°˜ë³µë¬¸ for
  - for ë°˜ë³µë¬¸ê³¼ range() í•¨ìˆ˜
  - ë ˆìŠ¨ 7ê°œ

Stage 4: ë°˜ë³µë¬¸ while
  - while ë°˜ë³µë¬¸ê³¼ break, continue
  - ë ˆìŠ¨ 6ê°œ

Stage 5: í•¨ìˆ˜
  - í•¨ìˆ˜ ì •ì˜ì™€ í˜¸ì¶œ, ë§¤ê°œë³€ìˆ˜ì™€ ë°˜í™˜ê°’
  - ë ˆìŠ¨ 8ê°œ


================================================================================
ğŸ”— ê´€ë ¨ ëª¨ë¸ ë§í¬
================================================================================

â†’ World: ì›”ë“œ ì •ë³´
â†’ Lesson: ìŠ¤í…Œì´ì§€ ë‚´ ë ˆìŠ¨
â†’ UserStageProgress: ì‚¬ìš©ìë³„ ìŠ¤í…Œì´ì§€ ì§„í–‰ ìƒí™©


================================================================================
ë!
================================================================================
