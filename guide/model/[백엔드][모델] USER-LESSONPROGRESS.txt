================================================================================
                    UserLessonProgress ëª¨ë¸ ì™„ì „ ì •ë¦¬
================================================================================

ì‘ì„±ì¼: 2025-11-06
íŒŒì¼: problems/models.py


================================================================================
ğŸ“¦ ëª¨ë¸ ê°œìš”
================================================================================

[ëª©ì ]
ì‚¬ìš©ìë³„ ë ˆìŠ¨ ì§„í–‰ ìƒí™© ì¶”ì  (2ë¼ìš´ë“œ ì‹œìŠ¤í…œ)
ë ˆìŠ¨ì€ 2ë¼ìš´ë“œë¡œ êµ¬ì„±:
- 1ë¼ìš´ë“œ: ëª¨ë“  ë¬¸ì œ í’€ê¸° (íŠ¸ë¼ì´ì–¼ + ì¦‰ì‹œ ì¬ì‹œë„)
- 2ë¼ìš´ë“œ: 1ë¼ìš´ë“œì—ì„œ í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ í’€ê¸°

[ìœ„ì¹˜]
Django App: problems
íŒŒì¼: problems/models.py
í…Œì´ë¸”ëª…: problems_userlessonprogress

[íŠ¹ì§•]
- 2ë¼ìš´ë“œ ì‹œìŠ¤í…œ ê´€ë¦¬
- í˜„ì¬ í’€ê³  ìˆëŠ” ë¬¸ì œ ì¶”ì  (current_problem_id)
- í‹€ë¦° ë¬¸ì œ ìë™ 2ë¼ìš´ë“œ ì´ë™
- í¬ê¸° ê¸°ëŠ¥ ì§€ì› (abandon_count)
- ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë ˆìŠ¨ ì ê¸ˆ í•´ì œ


================================================================================
ğŸ—‚ï¸ í•„ë“œ êµ¬ì¡°
================================================================================

user (ForeignKey)
â”œâ”€ ëŒ€ìƒ: settings.AUTH_USER_MODEL
â”œâ”€ on_delete: CASCADE
â”œâ”€ related_name: 'lesson_progresses'
â”œâ”€ ì„¤ëª…: ì‚¬ìš©ì
â””â”€ ì—­ì°¸ì¡°: user.lesson_progresses.all()

lesson (ForeignKey)
â”œâ”€ ëŒ€ìƒ: Lesson
â”œâ”€ on_delete: CASCADE
â”œâ”€ related_name: 'user_progresses'
â”œâ”€ ì„¤ëª…: ë ˆìŠ¨
â””â”€ ì—­ì°¸ì¡°: lesson.user_progresses.all()

is_in_progress (BooleanField)
â”œâ”€ ê¸°ë³¸ê°’: False
â”œâ”€ ì„¤ëª…: ì§„í–‰ ì¤‘ ì—¬ë¶€
â””â”€ True: ì§„í–‰ ì¤‘, False: ì‹œì‘ ì „ ë˜ëŠ” ì™„ë£Œ

is_completed (BooleanField)
â”œâ”€ ê¸°ë³¸ê°’: False
â”œâ”€ ì„¤ëª…: ì™„ë£Œ ì—¬ë¶€
â””â”€ 2ë¼ìš´ë“œê¹Œì§€ ëª¨ë‘ ì™„ë£Œ ì‹œ True

current_round (IntegerField)
â”œâ”€ ê¸°ë³¸ê°’: 1
â”œâ”€ ì„¤ëª…: í˜„ì¬ ë¼ìš´ë“œ (1 ë˜ëŠ” 2)
â””â”€ 1: ëª¨ë“  ë¬¸ì œ, 2: í‹€ë¦° ë¬¸ì œë§Œ

current_problem_id (IntegerField)
â”œâ”€ null/blank: True
â”œâ”€ ì„¤ëª…: í˜„ì¬ í’€ê³  ìˆëŠ” ë¬¸ì œ ID
â””â”€ ìš©ë„: "ì´ì–´ì„œ í•˜ê¸°" ê¸°ëŠ¥

completed_problems (JSONField)
â”œâ”€ ê¸°ë³¸ê°’: list (ë¹ˆ ë¦¬ìŠ¤íŠ¸)
â”œâ”€ ì„¤ëª…: ì™„ë£Œí•œ ë¬¸ì œ ID ëª©ë¡
â”œâ”€ ì˜ˆì‹œ: [1, 2, 3]
â””â”€ ìš©ë„: ì§„í–‰ ìƒí™© ì¶”ì 

failed_problems_this_round (JSONField)
â”œâ”€ ê¸°ë³¸ê°’: list (ë¹ˆ ë¦¬ìŠ¤íŠ¸)
â”œâ”€ ì„¤ëª…: í˜„ì¬ ë¼ìš´ë“œì—ì„œ í‹€ë¦° ë¬¸ì œ ID ëª©ë¡
â”œâ”€ ì˜ˆì‹œ: [2, 4]
â””â”€ ìš©ë„: 2ë¼ìš´ë“œì—ì„œ í’€ ë¬¸ì œ ê²°ì •

abandon_count (IntegerField)
â”œâ”€ ê¸°ë³¸ê°’: 0
â”œâ”€ ì„¤ëª…: í¬ê¸° íšŸìˆ˜
â””â”€ ìš©ë„: í†µê³„, ë¶„ì„

started_at (DateTimeField)
â”œâ”€ null/blank: True
â”œâ”€ ì„¤ëª…: ì‹œì‘ ì‹œê°„
â””â”€ 1ë¼ìš´ë“œ ì‹œì‘ ì‹œì 

completed_at (DateTimeField)
â”œâ”€ null/blank: True
â”œâ”€ ì„¤ëª…: ì™„ë£Œ ì‹œê°„
â””â”€ 2ë¼ìš´ë“œ ì™„ë£Œ ì‹œì 

created_at (DateTimeField)
â”œâ”€ ìë™ ìƒì„±: auto_now_add=True
â””â”€ ì„¤ëª…: ìƒì„±ì¼

updated_at (DateTimeField)
â”œâ”€ ìë™ ì—…ë°ì´íŠ¸: auto_now=True
â””â”€ ì„¤ëª…: ìˆ˜ì •ì¼


================================================================================
âš™ï¸ Meta ì„¤ì •
================================================================================

ordering = ['-updated_at']
â”œâ”€ ì •ë ¬: ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ìˆœ
â””â”€ ìš©ë„: "ìµœê·¼ í•™ìŠµ" ëª©ë¡

verbose_name = "ì‚¬ìš©ì ë ˆìŠ¨ ì§„í–‰ ìƒí™©"
verbose_name_plural = "ì‚¬ìš©ì ë ˆìŠ¨ ì§„í–‰ ëª©ë¡"

unique_together = (('user', 'lesson'),)
â”œâ”€ ì œì•½ì¡°ê±´: (ì‚¬ìš©ì, ë ˆìŠ¨) ì¡°í•© ìœ ì¼
â””â”€ íš¨ê³¼: í•œ ì‚¬ìš©ìëŠ” ê°™ì€ ë ˆìŠ¨ì— ëŒ€í•´ 1ê°œì˜ ì§„í–‰ ìƒí™©ë§Œ


================================================================================
ğŸ“Š í”„ë¡œí¼í‹° (Properties)
================================================================================

[@property] total_problems
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: í˜„ì¬ ë¼ìš´ë“œì˜ ì´ ë¬¸ì œ ìˆ˜
ë°˜í™˜: int
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    @property
    def total_problems(self):
        if self.current_round == 1:
            # 1ë¼ìš´ë“œ: ëª¨ë“  ë¬¸ì œ
            return self.lesson.problems.count()
        else:
            # 2ë¼ìš´ë“œ: í‹€ë¦° ë¬¸ì œë§Œ
            return len(self.failed_problems_this_round)

ë™ì‘:
    1ë¼ìš´ë“œ: ë ˆìŠ¨ì˜ ëª¨ë“  ë¬¸ì œ ìˆ˜
    2ë¼ìš´ë“œ: failed_problems_this_round ë¦¬ìŠ¤íŠ¸ ê¸¸ì´

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    total = progress.total_problems
    # 1ë¼ìš´ë“œ: 5ê°œ
    # 2ë¼ìš´ë“œ: 2ê°œ (1ë¼ìš´ë“œì—ì„œ í‹€ë¦° ë¬¸ì œ)

ì£¼ì˜ì‚¬í•­:
    âš ï¸ 1ë¼ìš´ë“œëŠ” DB ì¿¼ë¦¬ ë°œìƒ
    âš ï¸ 2ë¼ìš´ë“œëŠ” ë©”ëª¨ë¦¬ ê³„ì‚°


[@property] completed_problems_count
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: í˜„ì¬ ë¼ìš´ë“œì—ì„œ ì™„ë£Œí•œ ë¬¸ì œ ìˆ˜
ë°˜í™˜: int
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    @property
    def completed_problems_count(self):
        return len(self.completed_problems)

ë™ì‘:
    completed_problems ë¦¬ìŠ¤íŠ¸ ê¸¸ì´

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    completed = progress.completed_problems_count
    # 3ê°œ ì™„ë£Œ


[@property] progress_percentage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: í˜„ì¬ ë¼ìš´ë“œ ì§„í–‰ë¥  (í¼ì„¼íŠ¸)
ë°˜í™˜: int (0-100)
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    @property
    def progress_percentage(self):
        if self.total_problems == 0:
            return 0
        return int((self.completed_problems_count / self.total_problems) * 100)

ê³„ì‚°ì‹:
    (ì™„ë£Œí•œ ë¬¸ì œ / ì „ì²´ ë¬¸ì œ) * 100

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    percentage = progress.progress_percentage
    # 60% (5ê°œ ì¤‘ 3ê°œ ì™„ë£Œ)


================================================================================
ğŸ”§ ë©”ì„œë“œ (Methods)
================================================================================

[1] initialize_round_one()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: 1ë¼ìš´ë“œ ì´ˆê¸°í™”
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def initialize_round_one(self):
        """1ë¼ìš´ë“œ ì‹œì‘"""
        problems = self.lesson.problems.order_by('order')
        
        if problems.exists():
            first_problem = problems.first()
            self.current_problem_id = first_problem.id
            self.current_round = 1
            self.is_in_progress = True
            self.completed_problems = []
            self.failed_problems_this_round = []
            
            if not self.started_at:
                self.started_at = timezone.now()
            
            self.save()

ë™ì‘:
    1. ë ˆìŠ¨ì˜ ì²« ë²ˆì§¸ ë¬¸ì œ ì¡°íšŒ
    2. current_problem_id ì„¤ì •
    3. current_round = 1
    4. is_in_progress = True
    5. completed_problems, failed_problems_this_round ì´ˆê¸°í™”
    6. started_at ì„¤ì • (ìµœì´ˆ ì‹œì‘ ì‹œ)
    7. DB ì €ì¥

í˜¸ì¶œ ì‹œì :
    âœ“ ë ˆìŠ¨ ì‹œì‘í•  ë•Œ
    âœ“ ë³µìŠµí•  ë•Œ (reset_progress í›„)

ì‚¬ìš© ì˜ˆì‹œ:
    progress, created = UserLessonProgress.objects.get_or_create(
        user=user,
        lesson=lesson
    )
    progress.initialize_round_one()


[2] initialize_round_two()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: 2ë¼ìš´ë“œ ì´ˆê¸°í™”
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def initialize_round_two(self):
        """2ë¼ìš´ë“œ ì‹œì‘ (í‹€ë¦° ë¬¸ì œë§Œ)"""
        if not self.failed_problems_this_round:
            # í‹€ë¦° ë¬¸ì œ ì—†ìœ¼ë©´ ì™„ë£Œ
            self.complete_lesson()
            return
        
        # ì²« ë²ˆì§¸ í‹€ë¦° ë¬¸ì œ
        self.current_problem_id = self.failed_problems_this_round[0]
        self.current_round = 2
        self.completed_problems = []
        self.save()

ë™ì‘:
    1. failed_problems_this_round í™•ì¸
       - ë¹„ì–´ìˆìœ¼ë©´: complete_lesson() í˜¸ì¶œ (ì™„ë£Œ)
       - ìˆìœ¼ë©´: ë‹¤ìŒ ë‹¨ê³„
    2. ì²« ë²ˆì§¸ í‹€ë¦° ë¬¸ì œë¥¼ current_problem_idë¡œ ì„¤ì •
    3. current_round = 2
    4. completed_problems ì´ˆê¸°í™”
    5. DB ì €ì¥

í˜¸ì¶œ ì‹œì :
    âœ“ 1ë¼ìš´ë“œ ì™„ë£Œ í›„

ì‚¬ìš© ì˜ˆì‹œ:
    # 1ë¼ìš´ë“œ ë§ˆì§€ë§‰ ë¬¸ì œ ì™„ë£Œ
    progress.mark_problem_completed(last_problem_id)
    
    # ë‹¤ìŒ ë¬¸ì œê°€ ì—†ìœ¼ë©´ 2ë¼ìš´ë“œ ì‹œì‘
    if not next_problem:
        progress.initialize_round_two()


[3] mark_problem_completed(problem_id)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë¬¸ì œë¥¼ ì™„ë£Œ ì²˜ë¦¬
ë§¤ê°œë³€ìˆ˜: problem_id (int)
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def mark_problem_completed(self, problem_id):
        """ë¬¸ì œ ì™„ë£Œ ì²˜ë¦¬"""
        if problem_id not in self.completed_problems:
            self.completed_problems.append(problem_id)
        
        # 2ë¼ìš´ë“œë©´ í‹€ë¦° ë¬¸ì œ ëª©ë¡ì—ì„œ ì œê±°
        if self.current_round == 2:
            if problem_id in self.failed_problems_this_round:
                self.failed_problems_this_round.remove(problem_id)
        
        self.save()

ë™ì‘:
    1. completed_problemsì— ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
    2. 2ë¼ìš´ë“œì¸ ê²½ìš°:
       - failed_problems_this_roundì—ì„œ ì œê±°
    3. DB ì €ì¥

í˜¸ì¶œ ì‹œì :
    âœ“ ë¬¸ì œ ì •ë‹µ ì‹œ
    âœ“ ì¦‰ì‹œ ì¬ì‹œë„ ë¬¸ì œ 3ë²ˆ ì‹¤íŒ¨ í›„ ê°•ì œ í†µê³¼ ì‹œ

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    progress.mark_problem_completed(problem_id=3)


[4] mark_problem_failed(problem_id)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë¬¸ì œë¥¼ ì‹¤íŒ¨ ì²˜ë¦¬ (2ë¼ìš´ë“œë¡œ)
ë§¤ê°œë³€ìˆ˜: problem_id (int)
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def mark_problem_failed(self, problem_id):
        """ë¬¸ì œ ì‹¤íŒ¨ ì²˜ë¦¬ (2ë¼ìš´ë“œë¡œ)"""
        if problem_id not in self.failed_problems_this_round:
            self.failed_problems_this_round.append(problem_id)
        self.save()

ë™ì‘:
    1. failed_problems_this_roundì— ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
    2. DB ì €ì¥

í˜¸ì¶œ ì‹œì :
    âœ“ íŠ¸ë¼ì´ì–¼ ë¬¸ì œ ì˜¤ë‹µ ì‹œ (ê°ê´€ì‹, ë‹¨ì–´ ì„ íƒ, ì—°ê²°í•˜ê¸°)

ì‚¬ìš© ì˜ˆì‹œ:
    # íŠ¸ë¼ì´ì–¼ ë¬¸ì œ ì˜¤ë‹µ
    if problem.is_trial_problem() and not is_correct:
        progress.mark_problem_failed(problem_id)
        progress.move_to_next_problem()  # ë‹¤ìŒ ë¬¸ì œë¡œ


[5] move_to_next_problem()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def move_to_next_problem(self):
        """ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™"""
        if self.current_round == 1:
            # 1ë¼ìš´ë“œ: ìˆœì„œëŒ€ë¡œ
            problems = self.lesson.problems.order_by('order')
            current_problem = Problem.objects.get(id=self.current_problem_id)
            
            next_problem = problems.filter(
                order__gt=current_problem.order
            ).first()
            
            if next_problem:
                self.current_problem_id = next_problem.id
            else:
                # 1ë¼ìš´ë“œ ë â†’ 2ë¼ìš´ë“œ ì‹œì‘
                self.initialize_round_two()
                return
        
        else:  # round 2
            # 2ë¼ìš´ë“œ: í‹€ë¦° ë¬¸ì œ ìˆœì„œëŒ€ë¡œ
            current_index = self.failed_problems_this_round.index(
                self.current_problem_id
            )
            
            if current_index + 1 < len(self.failed_problems_this_round):
                self.current_problem_id = self.failed_problems_this_round[current_index + 1]
            else:
                # 2ë¼ìš´ë“œ ë â†’ ì™„ë£Œ
                self.complete_lesson()
                return
        
        self.save()

ë™ì‘:
    1ë¼ìš´ë“œ:
        1. í˜„ì¬ ë¬¸ì œ ë‹¤ìŒ orderì˜ ë¬¸ì œ ì°¾ê¸°
        2. ìˆìœ¼ë©´: current_problem_id ì—…ë°ì´íŠ¸
        3. ì—†ìœ¼ë©´: initialize_round_two() í˜¸ì¶œ
    
    2ë¼ìš´ë“œ:
        1. failed_problems_this_roundì—ì„œ í˜„ì¬ ì¸ë±ìŠ¤ ì°¾ê¸°
        2. ë‹¤ìŒ ì¸ë±ìŠ¤ê°€ ìˆìœ¼ë©´: ë‹¤ìŒ ë¬¸ì œë¡œ
        3. ì—†ìœ¼ë©´: complete_lesson() í˜¸ì¶œ

í˜¸ì¶œ ì‹œì :
    âœ“ ë¬¸ì œ ì •ë‹µ í›„
    âœ“ íŠ¸ë¼ì´ì–¼ ë¬¸ì œ ì˜¤ë‹µ í›„
    âœ“ ì¦‰ì‹œ ì¬ì‹œë„ ë¬¸ì œ 3ë²ˆ ì‹¤íŒ¨ í›„

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    progress.mark_problem_completed(problem_id)
    progress.move_to_next_problem()


[6] complete_lesson()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë ˆìŠ¨ ì™„ë£Œ ì²˜ë¦¬
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def complete_lesson(self):
        """ë ˆìŠ¨ ì™„ë£Œ"""
        self.is_completed = True
        self.is_in_progress = False
        self.completed_at = timezone.now()
        self.current_problem_id = None
        self.save()
        
        # UserWorld ì—…ë°ì´íŠ¸
        user_world = UserWorld.objects.get(
            user=self.user,
            world=self.lesson.stage.world
        )
        user_world.update_progress()
        user_world.touch()
        
        # UserStageProgress ì—…ë°ì´íŠ¸
        stage_progress, _ = UserStageProgress.objects.get_or_create(
            user=self.user,
            stage=self.lesson.stage
        )
        stage_progress.update_progress()

ë™ì‘:
    1. is_completed = True
    2. is_in_progress = False
    3. completed_at = í˜„ì¬ ì‹œê°„
    4. current_problem_id = None
    5. DB ì €ì¥
    6. UserWorld.update_progress() í˜¸ì¶œ
    7. UserWorld.touch() í˜¸ì¶œ
    8. UserStageProgress.update_progress() í˜¸ì¶œ

í˜¸ì¶œ ì‹œì :
    âœ“ 2ë¼ìš´ë“œ ì™„ë£Œ ì‹œ
    âœ“ 2ë¼ìš´ë“œ ì§„ì… ì‹œ í‹€ë¦° ë¬¸ì œê°€ ì—†ì„ ë•Œ

ì‚¬ìš© ì˜ˆì‹œ:
    # ìë™ í˜¸ì¶œë¨
    progress.initialize_round_two()  # ë‚´ë¶€ì—ì„œ í˜¸ì¶œ
    progress.move_to_next_problem()  # ë‚´ë¶€ì—ì„œ í˜¸ì¶œ


[7] reset_progress()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ì§„í–‰ ìƒí™© ì´ˆê¸°í™” (ë³µìŠµìš©)
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def reset_progress(self):
        """ë³µìŠµì„ ìœ„í•œ ì´ˆê¸°í™”"""
        self.is_completed = False
        self.is_in_progress = False
        self.current_round = 1
        self.current_problem_id = None
        self.completed_problems = []
        self.failed_problems_this_round = []
        self.completed_at = None
        self.save()

ë™ì‘:
    ëª¨ë“  ì§„í–‰ ìƒí™©ì„ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¼
    (started_atì€ ìœ ì§€)

í˜¸ì¶œ ì‹œì :
    âœ“ ë ˆìŠ¨ ë³µìŠµ ì‹œì‘ ì „

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    progress.reset_progress()
    progress.initialize_round_one()


[8] abandon_lesson()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë ˆìŠ¨ í¬ê¸° ì²˜ë¦¬
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def abandon_lesson(self):
        """ë ˆìŠ¨ í¬ê¸°"""
        self.abandon_count += 1
        self.is_in_progress = False
        self.save()

ë™ì‘:
    1. abandon_count ì¦ê°€
    2. is_in_progress = False
    3. DB ì €ì¥
    (ì§„í–‰ ìƒí™©ì€ ìœ ì§€ë¨)

í˜¸ì¶œ ì‹œì :
    âœ“ ì‚¬ìš©ìê°€ "í¬ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    progress.abandon_lesson()


[9] get_current_problem()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: í˜„ì¬ ë¬¸ì œ ê°ì²´ ë°˜í™˜
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: Problem ê°ì²´ ë˜ëŠ” None
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def get_current_problem(self):
        """í˜„ì¬ ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°"""
        if self.current_problem_id:
            try:
                return Problem.objects.get(id=self.current_problem_id)
            except Problem.DoesNotExist:
                return None
        return None

ë™ì‘:
    current_problem_idë¡œ Problem ì¡°íšŒ

í˜¸ì¶œ ì‹œì :
    âœ“ ë ˆìŠ¨ ì´ì–´í•˜ê¸°
    âœ“ í˜„ì¬ ë¬¸ì œ í‘œì‹œ

ì‚¬ìš© ì˜ˆì‹œ:
    progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
    current = progress.get_current_problem()
    
    if current:
        print(f"í˜„ì¬ ë¬¸ì œ: {current.title}")


[10] __str__()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë¬¸ìì—´ í‘œí˜„
ë°˜í™˜: f"{self.user.username} - {self.lesson.title} (Round {self.current_round})"
ì˜ˆì‹œ: "user1 - ë³€ìˆ˜ ì„ ì–¸í•˜ê¸° (Round 1)"


================================================================================
ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°
================================================================================

CREATE TABLE problems_userlessonprogress (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    lesson_id BIGINT NOT NULL,
    is_in_progress TINYINT(1) NOT NULL DEFAULT 0,
    is_completed TINYINT(1) NOT NULL DEFAULT 0,
    current_round INT NOT NULL DEFAULT 1,
    current_problem_id INT NULL,
    completed_problems JSON NOT NULL,
    failed_problems_this_round JSON NOT NULL,
    abandon_count INT NOT NULL DEFAULT 0,
    started_at DATETIME(6) NULL,
    completed_at DATETIME(6) NULL,
    created_at DATETIME(6) NOT NULL,
    updated_at DATETIME(6) NOT NULL,
    UNIQUE KEY unique_user_lesson (user_id, lesson_id),
    FOREIGN KEY (user_id) REFERENCES users_user(id),
    FOREIGN KEY (lesson_id) REFERENCES problems_lesson(id)
);


================================================================================
ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ
================================================================================

[1. ë ˆìŠ¨ ì‹œì‘]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
lesson = Lesson.objects.get(id=1)

# ì§„í–‰ ìƒí™© ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°
progress, created = UserLessonProgress.objects.get_or_create(
    user=user,
    lesson=lesson
)

# ë³µìŠµì´ë©´ ì´ˆê¸°í™”
if progress.is_completed:
    progress.reset_progress()

# 1ë¼ìš´ë“œ ì‹œì‘
progress.initialize_round_one()

# ì²« ë¬¸ì œ
current_problem = progress.get_current_problem()


[2. ë¬¸ì œ ì •ë‹µ ì²˜ë¦¬]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
problem = progress.get_current_problem()

# ì •ë‹µ í™•ì¸
is_correct = check_answer(answer, problem)

if is_correct:
    # ì™„ë£Œ í‘œì‹œ
    progress.mark_problem_completed(problem.id)
    
    # ë‹¤ìŒ ë¬¸ì œë¡œ
    progress.move_to_next_problem()
    
    # ì™„ë£ŒëëŠ”ì§€ í™•ì¸
    if progress.is_completed:
        print("ë ˆìŠ¨ ì™„ë£Œ!")
    else:
        next_problem = progress.get_current_problem()
        print(f"ë‹¤ìŒ ë¬¸ì œ: {next_problem.title}")


[3. íŠ¸ë¼ì´ì–¼ ë¬¸ì œ ì˜¤ë‹µ ì²˜ë¦¬]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
progress = UserLessonProgress.objects.get(user=user, lesson=lesson)
problem = progress.get_current_problem()

if problem.is_trial_problem() and not is_correct:
    # ì‹¤íŒ¨ í‘œì‹œ (2ë¼ìš´ë“œë¡œ)
    progress.mark_problem_failed(problem.id)
    
    # ë‹¤ìŒ ë¬¸ì œë¡œ (ì¦‰ì‹œ)
    progress.move_to_next_problem()


[4. ë ˆìŠ¨ ì´ì–´í•˜ê¸°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
progress = UserLessonProgress.objects.get(user=user, lesson=lesson)

if progress.is_in_progress:
    current = progress.get_current_problem()
    
    return Response({
        'message': 'ì´ì–´ì„œ ì‹œì‘!',
        'current_round': progress.current_round,
        'completed': progress.completed_problems_count,
        'total': progress.total_problems,
        'percentage': progress.progress_percentage,
        'current_problem': ProblemSerializer(current).data
    })


[5. ì§„í–‰ ìƒí™© ì¡°íšŒ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
progress = UserLessonProgress.objects.get(user=user, lesson=lesson)

print(f"ë¼ìš´ë“œ: {progress.current_round}")
print(f"ì§„í–‰ë¥ : {progress.progress_percentage}%")
print(f"ì™„ë£Œ: {progress.completed_problems_count}/{progress.total_problems}")
print(f"í¬ê¸°: {progress.abandon_count}ë²ˆ")

if progress.current_round == 2:
    print(f"í‹€ë¦° ë¬¸ì œ: {len(progress.failed_problems_this_round)}ê°œ")


================================================================================
ğŸŒ API Serializer ì˜ˆì‹œ
================================================================================

# problems/serializers.py

from rest_framework import serializers
from .models import UserLessonProgress

class UserLessonProgressSerializer(serializers.ModelSerializer):
    lesson_title = serializers.CharField(source='lesson.title', read_only=True)
    total_problems = serializers.IntegerField(read_only=True)
    completed_problems_count = serializers.IntegerField(read_only=True)
    progress_percentage = serializers.IntegerField(read_only=True)
    current_problem = serializers.SerializerMethodField()
    
    class Meta:
        model = UserLessonProgress
        fields = [
            'id',
            'lesson',
            'lesson_title',
            'is_in_progress',
            'is_completed',
            'current_round',
            'current_problem_id',
            'current_problem',
            'completed_problems',
            'completed_problems_count',
            'failed_problems_this_round',
            'total_problems',
            'progress_percentage',
            'abandon_count',
            'started_at',
            'completed_at',
            'created_at',
            'updated_at'
        ]
        read_only_fields = [
            'is_in_progress',
            'is_completed',
            'current_round',
            'completed_problems',
            'failed_problems_this_round',
            'abandon_count',
            'started_at',
            'completed_at',
            'created_at',
            'updated_at'
        ]
    
    def get_current_problem(self, obj):
        problem = obj.get_current_problem()
        if problem:
            from .serializers import ProblemSerializer
            return ProblemSerializer(problem).data
        return None


[API ì‘ë‹µ ì˜ˆì‹œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
    "id": 1,
    "lesson": 1,
    "lesson_title": "ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°",
    "is_in_progress": true,
    "is_completed": false,
    "current_round": 2,
    "current_problem_id": 4,
    "current_problem": {
        "id": 4,
        "title": "ë‘ ë³€ìˆ˜ì˜ í•©",
        "problem_type": "coding"
    },
    "completed_problems": [2],
    "completed_problems_count": 1,
    "failed_problems_this_round": [2, 4],
    "total_problems": 2,
    "progress_percentage": 50,
    "abandon_count": 0,
    "started_at": "2025-11-04T10:00:00Z",
    "completed_at": null,
    "created_at": "2025-11-04T10:00:00Z",
    "updated_at": "2025-11-04T14:30:00Z"
}


================================================================================
ğŸ® ì‹¤ì „ í™œìš© ì‹œë‚˜ë¦¬ì˜¤
================================================================================

[ì‹œë‚˜ë¦¬ì˜¤ 1: ë ˆìŠ¨ ì‹œì‘ API]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['POST'])
def start_lesson(request, lesson_id):
    """ë ˆìŠ¨ ì‹œì‘"""
    lesson = Lesson.objects.get(id=lesson_id)
    
    # ìƒíƒœ í™•ì¸
    status = lesson.get_status_for_user(request.user)
    if status == 'locked':
        return Response({'error': 'ì´ì „ ë ˆìŠ¨ ì™„ë£Œ í•„ìš”'}, status=403)
    
    # ì§„í–‰ ìƒí™© ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°
    progress, created = UserLessonProgress.objects.get_or_create(
        user=request.user,
        lesson=lesson
    )
    
    # ë³µìŠµì´ë©´ ì´ˆê¸°í™”
    if status == 'completed':
        progress.reset_progress()
    
    # 1ë¼ìš´ë“œ ì‹œì‘
    progress.initialize_round_one()
    
    # ì²« ë¬¸ì œ
    current = progress.get_current_problem()
    
    return Response({
        'message': 'ë³µìŠµ ì‹œì‘!' if status == 'completed' else 'ë ˆìŠ¨ ì‹œì‘!',
        'progress': UserLessonProgressSerializer(progress).data,
        'current_problem': ProblemSerializer(current).data
    })


[ì‹œë‚˜ë¦¬ì˜¤ 2: ë¬¸ì œ ì œì¶œ API]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['POST'])
def submit_answer(request, lesson_id):
    """ë‹µì•ˆ ì œì¶œ"""
    progress = UserLessonProgress.objects.get(
        user=request.user,
        lesson_id=lesson_id
    )
    
    problem = progress.get_current_problem()
    answer = request.data.get('answer')
    
    # ì •ë‹µ í™•ì¸
    is_correct = validate_answer(answer, problem)
    
    if is_correct:
        # ì™„ë£Œ ì²˜ë¦¬
        progress.mark_problem_completed(problem.id)
        progress.move_to_next_problem()
        
        # ë ˆìŠ¨ ì™„ë£Œ?
        if progress.is_completed:
            return Response({
                'status': 'lesson_complete',
                'message': 'ë ˆìŠ¨ ì™„ë£Œ!',
                'progress': UserLessonProgressSerializer(progress).data
            })
        
        # ë‹¤ìŒ ë¬¸ì œ
        next_problem = progress.get_current_problem()
        return Response({
            'status': 'correct',
            'next_problem': ProblemSerializer(next_problem).data
        })
    
    else:
        # íŠ¸ë¼ì´ì–¼ ë¬¸ì œ
        if problem.is_trial_problem():
            progress.mark_problem_failed(problem.id)
            progress.move_to_next_problem()
            
            next_problem = progress.get_current_problem()
            return Response({
                'status': 'wrong_trial',
                'hint': get_hint(problem, attempt_count),
                'next_problem': ProblemSerializer(next_problem).data
            })
        
        # ì¦‰ì‹œ ì¬ì‹œë„
        else:
            attempt_count += 1
            if attempt_count >= 3:
                # ê°•ì œ í†µê³¼
                progress.move_to_next_problem()
            
            return Response({
                'status': 'wrong_retry',
                'hint': get_hint(problem, attempt_count),
                'attempt_count': attempt_count
            })


[ì‹œë‚˜ë¦¬ì˜¤ 3: ë ˆìŠ¨ í¬ê¸° API]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@api_view(['POST'])
def abandon_lesson(request, lesson_id):
    """ë ˆìŠ¨ í¬ê¸°"""
    progress = UserLessonProgress.objects.get(
        user=request.user,
        lesson_id=lesson_id
    )
    
    progress.abandon_lesson()
    
    return Response({
        'message': 'ë ˆìŠ¨ì„ í¬ê¸°í–ˆìŠµë‹ˆë‹¤',
        'abandon_count': progress.abandon_count
    })


================================================================================
âš ï¸ ì£¼ì˜ì‚¬í•­
================================================================================

[1. ìë™ ì‹¤í–‰ ì•ˆ ë¨]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ ëª¨ë“  ë©”ì„œë“œëŠ” ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•¨!

ì˜ëª»ëœ ì˜ˆ:
    progress.mark_problem_completed(1)
    # â†’ move_to_next_problem() ìë™ í˜¸ì¶œ ì•ˆ ë¨!

ì˜¬ë°”ë¥¸ ì˜ˆ:
    progress.mark_problem_completed(1)
    progress.move_to_next_problem()  # âœ…


[2. JSON í•„ë“œ íƒ€ì…]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ completed_problems, failed_problems_this_roundëŠ” ë¦¬ìŠ¤íŠ¸
âš ï¸ ìˆ˜ì • í›„ save() í•„ìˆ˜!

ì˜ëª»ëœ ì˜ˆ:
    progress.completed_problems.append(1)
    # â†’ DB ì €ì¥ ì•ˆ ë¨!

ì˜¬ë°”ë¥¸ ì˜ˆ:
    progress.completed_problems.append(1)
    progress.save()  # âœ…


[3. unique_together]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê°™ì€ ì‚¬ìš©ìëŠ” ê°™ì€ ë ˆìŠ¨ì— ëŒ€í•´ 1ê°œì˜ ì§„í–‰ ìƒí™©ë§Œ

âŒ IntegrityError:
    UserLessonProgress.objects.create(user=user1, lesson=lesson1)
    UserLessonProgress.objects.create(user=user1, lesson=lesson1)

âœ… ì•ˆì „í•œ ë°©ë²•:
    progress, created = UserLessonProgress.objects.get_or_create(
        user=user1,
        lesson=lesson1
    )


[4. 2ë¼ìš´ë“œ ì‹œìŠ¤í…œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ë¼ìš´ë“œ: ëª¨ë“  ë¬¸ì œ
    â†’ íŠ¸ë¼ì´ì–¼ í‹€ë¦¬ë©´ failed_problems_this_roundì— ì¶”ê°€
    â†’ ì¦‰ì‹œ ì¬ì‹œë„ëŠ” ë§ì„ ë•Œê¹Œì§€

2ë¼ìš´ë“œ: failed_problems_this_roundë§Œ
    â†’ ëª¨ë‘ ë§ì¶”ë©´ ì™„ë£Œ


================================================================================
ğŸ“ ë°ì´í„° ì˜ˆì‹œ
================================================================================

[1ë¼ìš´ë“œ ì§„í–‰ ì¤‘]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
current_round: 1
current_problem_id: 3
completed_problems: [1, 2]  # ë¬¸ì œ 1, 2 ì™„ë£Œ
failed_problems_this_round: [2]  # ë¬¸ì œ 2 í‹€ë¦¼
total_problems: 5
progress_percentage: 40%

[2ë¼ìš´ë“œ ì§„í–‰ ì¤‘]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
current_round: 2
current_problem_id: 2
completed_problems: []  # 2ë¼ìš´ë“œì—ì„œ ìƒˆë¡œ ì‹œì‘
failed_problems_this_round: [2, 4]  # 1ë¼ìš´ë“œì—ì„œ í‹€ë¦° ë¬¸ì œ
total_problems: 2
progress_percentage: 0%


================================================================================
ğŸ”— ê´€ë ¨ ëª¨ë¸ ë§í¬
================================================================================

â†’ Lesson: ë ˆìŠ¨ ì •ë³´
â†’ Problem: ë¬¸ì œ ì •ë³´
â†’ ProblemAttempt: ë¬¸ì œë³„ ì‹œë„ ê¸°ë¡
â†’ UserWorld: ì›”ë“œ ì§„í–‰ ìƒí™©
â†’ UserStageProgress: ìŠ¤í…Œì´ì§€ ì§„í–‰ ìƒí™©


================================================================================
ë!
================================================================================
