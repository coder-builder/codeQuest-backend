================================================================================
                         Problem ëª¨ë¸ ì™„ì „ ì •ë¦¬
================================================================================

ì‘ì„±ì¼: 2025-11-06
íŒŒì¼: problems/models.py


================================================================================
ğŸ“¦ ëª¨ë¸ ê°œìš”
================================================================================

[ëª©ì ]
ë ˆìŠ¨ ë‚´ ë¬¸ì œ
ê° ë ˆìŠ¨ì€ 4-5ê°œì˜ ë¬¸ì œë¡œ êµ¬ì„±
7ê°€ì§€ ë¬¸ì œ íƒ€ì… ì§€ì›

[ìœ„ì¹˜]
Django App: problems
íŒŒì¼: problems/models.py
í…Œì´ë¸”ëª…: problems_problem

[íŠ¹ì§•]
- 7ê°€ì§€ ë¬¸ì œ íƒ€ì… ì§€ì›
- ì½”ë”© ë¬¸ì œëŠ” Judge0 ì—°ë™
- ë‹¨ê³„ë³„ íŒíŠ¸ ì œê³µ (3ë‹¨ê³„)
- íŠ¸ë¼ì´ì–¼ vs ì¦‰ì‹œ ì¬ì‹œë„ ë°©ì‹
- ë³´ìŠ¤ ë¬¸ì œ ì§€ì›
- unique_togetherë¡œ (lesson, order) ì¤‘ë³µ ë°©ì§€


================================================================================
ğŸ—‚ï¸ í•„ë“œ êµ¬ì¡°
================================================================================

lesson (ForeignKey)
â”œâ”€ ëŒ€ìƒ: Lesson
â”œâ”€ on_delete: CASCADE
â”œâ”€ related_name: 'problems'
â”œâ”€ ì„¤ëª…: ë ˆìŠ¨
â””â”€ ì—­ì°¸ì¡°: lesson.problems.all()

title (CharField)
â”œâ”€ ìµœëŒ€ ê¸¸ì´: 200ì
â”œâ”€ ì„¤ëª…: ë¬¸ì œ ì œëª©
â””â”€ ì˜ˆì‹œ: "ë³€ìˆ˜ì— ê°’ ì €ì¥í•˜ê¸°", "ifë¬¸ìœ¼ë¡œ ì§ìˆ˜ íŒë³„"

description (TextField)
â”œâ”€ ì„¤ëª…: ë¬¸ì œ ì„¤ëª…
â””â”€ ì˜ˆì‹œ: "x ë³€ìˆ˜ì— 10ì„ ì €ì¥í•˜ê³ , y ë³€ìˆ˜ì— 20ì„ ì €ì¥í•˜ì„¸ìš”"

problem_type (CharField)
â”œâ”€ ìµœëŒ€ ê¸¸ì´: 20ì
â”œâ”€ ì„ íƒì§€: PROBLEM_TYPE_CHOICES (7ê°€ì§€)
â”œâ”€ ê¸°ë³¸ê°’: 'coding'
â””â”€ ì„¤ëª…: ë¬¸ì œ íƒ€ì…

problem_data (JSONField)
â”œâ”€ ê¸°ë³¸ê°’: dict
â”œâ”€ ì„¤ëª…: ë¬¸ì œ íƒ€ì…ë³„ ë°ì´í„° ì €ì¥
â””â”€ ì˜ˆì‹œ: ê°ê´€ì‹ ì„ íƒì§€, ë¸”ë¡ ëª©ë¡ ë“±

correct_answer (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: ì •ë‹µ (ê°„ë‹¨í•œ ë¬¸ì œìš©)
â””â”€ ì˜ˆì‹œ: "in", "5"

correct_explanation (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: ì •ë‹µ í•´ì„¤
â””â”€ ì˜ˆì‹œ: "inì€ forë¬¸ì—ì„œ ë°˜ë³µí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” í‚¤ì›Œë“œì…ë‹ˆë‹¤"

first_hint (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: 1ì°¨ íŒíŠ¸ (ì²« ë²ˆì§¸ ì˜¤ë‹µ ì‹œ)
â””â”€ ì˜ˆì‹œ: "ë³€ìˆ˜ëŠ” = ê¸°í˜¸ë¥¼ ì‚¬ìš©í•´ì„œ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤"

second_hint (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: 2ì°¨ íŒíŠ¸ (ë‘ ë²ˆì§¸ ì˜¤ë‹µ ì‹œ)
â””â”€ ì˜ˆì‹œ: "x = 10 ì²˜ëŸ¼ ë³€ìˆ˜ëª… = ê°’ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤"

third_hint (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: 3ì°¨ íŒíŠ¸ (ì„¸ ë²ˆì§¸ ì˜¤ë‹µ ì‹œ)
â””â”€ ì˜ˆì‹œ: "x = 10\ny = 20"

difficulty (CharField)
â”œâ”€ ìµœëŒ€ ê¸¸ì´: 20ì
â”œâ”€ ì„ íƒì§€: DIFFICULTY_CHOICES
â”‚   - 'easy': ì‰¬ì›€
â”‚   - 'medium': ë³´í†µ
â”‚   - 'hard': ì–´ë ¤ì›€
â”œâ”€ ê¸°ë³¸ê°’: 'easy'
â””â”€ ì„¤ëª…: ë‚œì´ë„

is_boss_problem (BooleanField)
â”œâ”€ ê¸°ë³¸ê°’: False
â”œâ”€ ì„¤ëª…: ë³´ìŠ¤ ë¬¸ì œ ì—¬ë¶€
â””â”€ ìš©ë„: íŠ¹ë³„í•œ ë¬¸ì œ í‘œì‹œ (ì™•ê´€ ì•„ì´ì½˜ ë“±)

order (IntegerField)
â”œâ”€ ì„¤ëª…: ìˆœì„œ
â””â”€ ì˜ˆì‹œ: 1, 2, 3...

initial_code (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: ì´ˆê¸° ì½”ë“œ (ì½”ë”© ë¬¸ì œìš©)
â””â”€ ì˜ˆì‹œ: "# ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”\n"

solution_code (TextField)
â”œâ”€ blank: True
â”œâ”€ ì„¤ëª…: ì •ë‹µ ì½”ë“œ (ì½”ë”© ë¬¸ì œìš©)
â””â”€ ì˜ˆì‹œ: "x = 10\ny = 20\nprint(x + y)"

time_limit (IntegerField)
â”œâ”€ ê¸°ë³¸ê°’: 2
â”œâ”€ ì„¤ëª…: ì‹œê°„ ì œí•œ (ì´ˆ)
â””â”€ ìš©ë„: Judge0 ì‹¤í–‰ ì œí•œ

memory_limit (IntegerField)
â”œâ”€ ê¸°ë³¸ê°’: 128
â”œâ”€ ì„¤ëª…: ë©”ëª¨ë¦¬ ì œí•œ (MB)
â””â”€ ìš©ë„: Judge0 ì‹¤í–‰ ì œí•œ

exp_reward (IntegerField)
â”œâ”€ ê¸°ë³¸ê°’: 10
â”œâ”€ ì„¤ëª…: EXP ë³´ìƒ
â””â”€ ìš©ë„: ê²Œì„í™” ìš”ì†Œ

coin_reward (IntegerField)
â”œâ”€ ê¸°ë³¸ê°’: 5
â”œâ”€ ì„¤ëª…: ì½”ì¸ ë³´ìƒ
â””â”€ ìš©ë„: ê²Œì„í™” ìš”ì†Œ

created_at (DateTimeField)
â”œâ”€ ìë™ ìƒì„±: auto_now_add=True
â””â”€ ì„¤ëª…: ìƒì„±ì¼

updated_at (DateTimeField)
â”œâ”€ ìë™ ì—…ë°ì´íŠ¸: auto_now=True
â””â”€ ì„¤ëª…: ìˆ˜ì •ì¼


================================================================================
ğŸ“Š ë¬¸ì œ íƒ€ì… (PROBLEM_TYPE_CHOICES)
================================================================================

[1] 'multiple_choice': ê°ê´€ì‹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: 4ê°œ ì¤‘ 1ê°œ ì„ íƒ
íŠ¸ë¼ì´ì–¼: âœ… (í‹€ë ¤ë„ ë‹¤ìŒìœ¼ë¡œ)

problem_data êµ¬ì¡°:
{
    "question": "Pythonì˜ ì£¼ì„ ê¸°í˜¸ëŠ”?",
    "choices": ["//", "#", "/*", "<!--"],
    "correct_answer": "#"
}


[2] 'word_bank': ë‹¨ì–´ ì„ íƒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ë‹¨ì–´ ì„ íƒ
íŠ¸ë¼ì´ì–¼: âœ… (í‹€ë ¤ë„ ë‹¤ìŒìœ¼ë¡œ)

problem_data êµ¬ì¡°:
{
    "template": "for i ___ range(___): print(i)",
    "blanks": [
        {"index": 0, "options": ["in", "at"], "correct": "in"},
        {"index": 1, "options": ["3", "5"], "correct": "5"}
    ]
}


[3] 'arrange_blocks': ë¸”ë¡ ìˆœì„œ ë°°ì—´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: ì½”ë“œ ë¸”ë¡ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ë°°ì—´
ì¦‰ì‹œ ì¬ì‹œë„: âœ… (ë§ì„ ë•Œê¹Œì§€)

problem_data êµ¬ì¡°:
{
    "blocks": ["x = 10", "y = 20", "result = x + y", "print(result)"],
    "dependencies": [[0, 2], [1, 2], [2, 3]]
}


[4] 'matching': ì—°ê²°í•˜ê¸°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ í•­ëª© ì—°ê²°
íŠ¸ë¼ì´ì–¼: âœ… (í‹€ë ¤ë„ ë‹¤ìŒìœ¼ë¡œ)

problem_data êµ¬ì¡°:
{
    "left_items": ["print()", "input()"],
    "right_items": ["ì¶œë ¥", "ì…ë ¥"],
    "correct_pairs": {"print()": "ì¶œë ¥", "input()": "ì…ë ¥"}
}


[5] 'copy_code': ì½”ë“œ ë”°ë¼ì“°ê¸°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: ì œì‹œëœ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¼ ì‘ì„±
ì¦‰ì‹œ ì¬ì‹œë„: âœ… (ë§ì„ ë•Œê¹Œì§€)

problem_data êµ¬ì¡°:
{
    "code_to_copy": "for i in range(5):\\n    print(i)",
    "case_sensitive": true,
    "whitespace_sensitive": true
}


[6] 'coding': ì½”ë”© ë¬¸ì œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: ì‹¤ì œ ì½”ë“œ ì‘ì„± (Judge0 ì‹¤í–‰)
ì¦‰ì‹œ ì¬ì‹œë„: âœ… (ë§ì„ ë•Œê¹Œì§€)

í•„ë“œ ì‚¬ìš©:
- initial_code: ì´ˆê¸° ì½”ë“œ
- solution_code: ì •ë‹µ ì½”ë“œ
- test_cases: TestCase ëª¨ë¸ë¡œ ë³„ë„ ê´€ë¦¬


[7] 'fill_code': ì½”ë“œ ë¹ˆì¹¸ ì±„ìš°ê¸°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì„¤ëª…: ì½”ë“œì˜ ë¹ˆì¹¸ì„ ì±„ìš°ê¸° (Judge0 ì‹¤í–‰)
ì¦‰ì‹œ ì¬ì‹œë„: âœ… (ë§ì„ ë•Œê¹Œì§€)

problem_data êµ¬ì¡°:
{
    "template": "for i in range(___):  # TODO: ë¹ˆì¹¸ ì±„ìš°ê¸°",
    "blanks": ["5"]
}


================================================================================
âš™ï¸ Meta ì„¤ì •
================================================================================

ordering = ['lesson__stage__order', 'lesson__order', 'order']
â”œâ”€ ì •ë ¬ ìš°ì„ ìˆœìœ„:
â”‚   1. ìŠ¤í…Œì´ì§€ ìˆœì„œ
â”‚   2. ë ˆìŠ¨ ìˆœì„œ
â”‚   3. ë¬¸ì œ ìˆœì„œ
â””â”€ ì „ì²´ ìˆœì„œëŒ€ë¡œ ì •ë ¬

verbose_name = "ë¬¸ì œ"
verbose_name_plural = "ë¬¸ì œ ëª©ë¡"

unique_together = (('lesson', 'order'),)
â”œâ”€ ì œì•½ì¡°ê±´: (ë ˆìŠ¨, ìˆœì„œ) ì¡°í•© ìœ ì¼
â””â”€ íš¨ê³¼: í•œ ë ˆìŠ¨ ë‚´ì—ì„œ ê°™ì€ order ë²ˆí˜¸ ì¤‘ë³µ ë¶ˆê°€


================================================================================
ğŸ”§ ë©”ì„œë“œ (Methods)
================================================================================

[ë©”ì„œë“œ] needs_judge0()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: Judge0 ì½”ë“œ ì‹¤í–‰ì´ í•„ìš”í•œì§€ í™•ì¸
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: bool
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def needs_judge0(self):
        return self.problem_type in ['coding', 'fill_code']

ë™ì‘:
    problem_typeì´ 'coding' ë˜ëŠ” 'fill_code'ë©´ True
    ê·¸ ì™¸ëŠ” False

ì‚¬ìš© ì‹œì :
    âœ“ ë‹µì•ˆ ì œì¶œ ì‹œ ì²˜ë¦¬ ë°©ì‹ ê²°ì •
    âœ“ Judge0 API í˜¸ì¶œ ì—¬ë¶€ íŒë‹¨

ì‚¬ìš© ì˜ˆì‹œ:
    problem = Problem.objects.get(id=1)
    
    if problem.needs_judge0():
        # Judge0 API í˜¸ì¶œ
        result = judge0_service.submit_code(code, problem)
    else:
        # í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê²€ì¦
        is_correct = validate_answer(answer, problem.correct_answer)


[ë©”ì„œë“œ] is_trial_problem()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: íŠ¸ë¼ì´ì–¼ ë°©ì‹ ë¬¸ì œì¸ì§€ í™•ì¸ (í‹€ë ¤ë„ ë‹¤ìŒìœ¼ë¡œ)
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: bool
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def is_trial_problem(self):
        return self.problem_type in [
            'multiple_choice',
            'word_bank',
            'matching'
        ]

ë™ì‘:
    problem_typeì´ ìœ„ 3ê°€ì§€ ì¤‘ í•˜ë‚˜ë©´ True

ë¬¸ì œ í•´ê²° íë¦„:
    ì •ë‹µ: â†’ ë‹¤ìŒ ë¬¸ì œ
    ì˜¤ë‹µ 1ì°¨: â†’ íŒíŠ¸1 + ë‹¤ìŒ ë¬¸ì œ
    ì˜¤ë‹µ 2ì°¨: â†’ íŒíŠ¸2 + ë‹¤ìŒ ë¬¸ì œ
    ì˜¤ë‹µ 3ì°¨: â†’ íŒíŠ¸3 + ì •ë‹µ + ë‹¤ìŒ ë¬¸ì œ

íŠ¹ì§•:
    âœ“ í‹€ë ¤ë„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°
    âœ“ ë¼ìš´ë“œ ì¢…ë£Œ í›„ í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ í’€ê¸°
    âœ“ failed_problems_this_roundì— ì¶”ê°€

ì‚¬ìš© ì˜ˆì‹œ:
    problem = Problem.objects.get(id=1)
    
    if problem.is_trial_problem():
        # ì •ë‹µ í™•ì¸
        if is_correct:
            progress.mark_problem_completed(problem.id)
        else:
            progress.mark_problem_failed(problem.id)
        
        # ë‘˜ ë‹¤ ë‹¤ìŒ ë¬¸ì œë¡œ
        progress.move_to_next_problem()


[ë©”ì„œë“œ] is_immediate_retry()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ì¦‰ì‹œ ì¬ì‹œë„ ë°©ì‹ ë¬¸ì œì¸ì§€ í™•ì¸ (ë§ì„ ë•Œê¹Œì§€)
ë§¤ê°œë³€ìˆ˜: ì—†ìŒ
ë°˜í™˜: bool
ìë™ ì‹¤í–‰: âŒ

êµ¬í˜„:
    def is_immediate_retry(self):
        return self.problem_type in [
            'arrange_blocks',
            'copy_code',
            'coding',
            'fill_code'
        ]

ë™ì‘:
    problem_typeì´ ìœ„ 4ê°€ì§€ ì¤‘ í•˜ë‚˜ë©´ True

ë¬¸ì œ í•´ê²° íë¦„:
    ì •ë‹µ: â†’ ë‹¤ìŒ ë¬¸ì œ
    ì˜¤ë‹µ 1ì°¨: â†’ íŒíŠ¸1 + ì¦‰ì‹œ ì¬ì‹œë„
    ì˜¤ë‹µ 2ì°¨: â†’ íŒíŠ¸2 + ì¦‰ì‹œ ì¬ì‹œë„
    ì˜¤ë‹µ 3ì°¨: â†’ íŒíŠ¸3 + ê°•ì œ í†µê³¼ + ë‹¤ìŒ ë¬¸ì œ

íŠ¹ì§•:
    âœ“ ë§ì„ ë•Œê¹Œì§€ ì¬ì‹œë„
    âœ“ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŒ
    âœ“ 3ë²ˆ ì‹¤íŒ¨ ì‹œ ê°•ì œ í†µê³¼

ì‚¬ìš© ì˜ˆì‹œ:
    problem = Problem.objects.get(id=1)
    
    if problem.is_immediate_retry():
        if is_correct:
            progress.mark_problem_completed(problem.id)
            progress.move_to_next_problem()
        else:
            # íŒíŠ¸ë§Œ ì£¼ê³  ì¬ì‹œë„
            attempt_count += 1
            if attempt_count >= 3:
                # ê°•ì œ í†µê³¼
                progress.move_to_next_problem()


[ë©”ì„œë“œ] __str__()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê¸°ëŠ¥: ë¬¸ìì—´ í‘œí˜„
ë°˜í™˜: ì•„ì´ì½˜ + ë ˆìŠ¨ ì œëª© + ë¬¸ì œ ë²ˆí˜¸ + ì œëª© + ë³´ìŠ¤ í‘œì‹œ
ì˜ˆì‹œ:
    "ğŸ’» ë³€ìˆ˜ ì„ ì–¸í•˜ê¸° - 1. ë³€ìˆ˜ì— ê°’ ì €ì¥í•˜ê¸°"
    "ğŸ“ ì¡°ê±´ë¬¸ ê¸°ì´ˆ - 3. ifë¬¸ ì‘ì„±í•˜ê¸° ğŸ‘‘"  # ë³´ìŠ¤ ë¬¸ì œ

ì•„ì´ì½˜:
    ğŸ“ multiple_choice (ê°ê´€ì‹)
    ğŸ”¤ word_bank (ë‹¨ì–´ ì„ íƒ)
    ğŸ§© arrange_blocks (ë¸”ë¡ ìˆœì„œ)
    ğŸ”— matching (ì—°ê²°í•˜ê¸°)
    âœï¸ copy_code (ë”°ë¼ì“°ê¸°)
    ğŸ’» coding (ì½”ë”© ë¬¸ì œ)
    ğŸ“‹ fill_code (ë¹ˆì¹¸ ì±„ìš°ê¸°)


================================================================================
ğŸ”— ê´€ê³„ (Relationships)
================================================================================

[Forward Relation]
problem.lesson
â”œâ”€ ì ‘ê·¼: problem.lesson
â”œâ”€ íƒ€ì…: Lesson ê°ì²´
â””â”€ ì˜ˆì‹œ: problem.lesson.title â†’ "ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°"

[Reverse Relations]
problem.test_cases
â”œâ”€ related_name: test_cases
â”œâ”€ ì ‘ê·¼: problem.test_cases.all()
â”œâ”€ ì„¤ëª…: ì´ ë¬¸ì œì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (ì½”ë”© ë¬¸ì œìš©)
â””â”€ ì˜ˆì‹œ:
    problem = Problem.objects.get(id=1)
    test_cases = problem.test_cases.all()


================================================================================
ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°
================================================================================

CREATE TABLE problems_problem (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    lesson_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    problem_type VARCHAR(20) NOT NULL DEFAULT 'coding',
    problem_data JSON NOT NULL,
    correct_answer TEXT,
    correct_explanation TEXT,
    first_hint TEXT,
    second_hint TEXT,
    third_hint TEXT,
    difficulty VARCHAR(20) NOT NULL DEFAULT 'easy',
    is_boss_problem TINYINT(1) NOT NULL DEFAULT 0,
    `order` INT NOT NULL,
    initial_code TEXT,
    solution_code TEXT,
    time_limit INT NOT NULL DEFAULT 2,
    memory_limit INT NOT NULL DEFAULT 128,
    exp_reward INT NOT NULL DEFAULT 10,
    coin_reward INT NOT NULL DEFAULT 5,
    created_at DATETIME(6) NOT NULL,
    updated_at DATETIME(6) NOT NULL,
    UNIQUE KEY unique_lesson_order (lesson_id, `order`),
    FOREIGN KEY (lesson_id) REFERENCES problems_lesson(id)
);


================================================================================
ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ
================================================================================

[1. ê°ê´€ì‹ ë¬¸ì œ ìƒì„±]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
lesson = Lesson.objects.get(id=1)

problem = Problem.objects.create(
    lesson=lesson,
    title='Pythonì˜ ì£¼ì„ ê¸°í˜¸',
    description='Pythonì—ì„œ ì£¼ì„ì„ ì‘ì„±í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°í˜¸ëŠ”?',
    problem_type='multiple_choice',
    problem_data={
        "question": "Pythonì˜ ì£¼ì„ ê¸°í˜¸ëŠ”?",
        "choices": ["//", "#", "/*", "<!--"],
        "correct_answer": "#"
    },
    correct_explanation='#ì€ Pythonì—ì„œ í•œ ì¤„ ì£¼ì„ì„ ì‘ì„±í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤',
    first_hint='C++ë‚˜ JavaScriptì™€ ë‹¤ë¥¸ ê¸°í˜¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤',
    second_hint='ìƒµ(#) ê¸°í˜¸ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤',
    third_hint='ì •ë‹µì€ # ì…ë‹ˆë‹¤',
    order=1,
    difficulty='easy',
    exp_reward=10,
    coin_reward=5
)


[2. ì½”ë”© ë¬¸ì œ ìƒì„±]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
problem = Problem.objects.create(
    lesson=lesson,
    title='ë‘ ìˆ˜ì˜ í•© ì¶œë ¥',
    description='xì— 10, yì— 20ì„ ì €ì¥í•˜ê³  í•©ì„ ì¶œë ¥í•˜ì„¸ìš”',
    problem_type='coding',
    initial_code='# ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”\n',
    solution_code='x = 10\ny = 20\nprint(x + y)',
    first_hint='x = 10ì²˜ëŸ¼ ë³€ìˆ˜ì— ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤',
    second_hint='print() í•¨ìˆ˜ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤',
    third_hint='x = 10\ny = 20\nprint(x + y)',
    order=2,
    difficulty='easy',
    time_limit=2,
    memory_limit=128,
    exp_reward=15,
    coin_reward=10
)

# í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€
TestCase.objects.create(
    problem=problem,
    input_data='',
    expected_output='30',
    order=1
)


[3. ë¬¸ì œ íƒ€ì… í™•ì¸]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
problem = Problem.objects.get(id=1)

if problem.needs_judge0():
    print("Judge0 ì‹¤í–‰ í•„ìš”")
else:
    print("í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦")

if problem.is_trial_problem():
    print("íŠ¸ë¼ì´ì–¼ ë°©ì‹")
elif problem.is_immediate_retry():
    print("ì¦‰ì‹œ ì¬ì‹œë„ ë°©ì‹")


[4. ë¬¸ì œ ì œì¶œ ì²˜ë¦¬]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def handle_problem_submission(problem, answer, progress, attempt):
    """ë¬¸ì œ ì œì¶œ ì²˜ë¦¬"""
    
    # Judge0 í•„ìš”?
    if problem.needs_judge0():
        result = judge0_service.submit_code(answer, problem)
        is_correct = result['is_correct']
    else:
        is_correct = (answer == problem.correct_answer)
    
    # ì •ë‹µ
    if is_correct:
        progress.mark_problem_completed(problem.id)
        progress.move_to_next_problem()
        return {'status': 'correct', 'next': True}
    
    # ì˜¤ë‹µ
    attempt.attempt_count += 1
    attempt.save()
    
    # íŠ¸ë¼ì´ì–¼ ë¬¸ì œ
    if problem.is_trial_problem():
        progress.mark_problem_failed(problem.id)
        progress.move_to_next_problem()
        
        hint = get_hint(problem, attempt.attempt_count)
        return {'status': 'wrong_trial', 'hint': hint, 'next': True}
    
    # ì¦‰ì‹œ ì¬ì‹œë„
    if problem.is_immediate_retry():
        if attempt.attempt_count >= 3:
            # ê°•ì œ í†µê³¼
            progress.move_to_next_problem()
            return {'status': 'forced_pass', 'next': True}
        
        hint = get_hint(problem, attempt.attempt_count)
        return {'status': 'wrong_retry', 'hint': hint, 'next': False}


================================================================================
ğŸŒ API Serializer ì˜ˆì‹œ
================================================================================

# problems/serializers.py

from rest_framework import serializers
from .models import Problem

class ProblemSerializer(serializers.ModelSerializer):
    lesson_title = serializers.CharField(source='lesson.title', read_only=True)
    needs_judge0 = serializers.BooleanField(read_only=True)
    is_trial = serializers.SerializerMethodField()
    is_immediate_retry = serializers.BooleanField(read_only=True)
    
    class Meta:
        model = Problem
        fields = [
            'id',
            'lesson',
            'lesson_title',
            'title',
            'description',
            'problem_type',
            'problem_data',
            'difficulty',
            'is_boss_problem',
            'order',
            'initial_code',
            'time_limit',
            'memory_limit',
            'exp_reward',
            'coin_reward',
            'needs_judge0',
            'is_trial',
            'is_immediate_retry',
            'created_at'
        ]
        read_only_fields = ['created_at']
    
    def get_is_trial(self, obj):
        return obj.is_trial_problem()


[API ì‘ë‹µ ì˜ˆì‹œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
    "id": 1,
    "lesson": 1,
    "lesson_title": "ë³€ìˆ˜ ì„ ì–¸í•˜ê¸°",
    "title": "Pythonì˜ ì£¼ì„ ê¸°í˜¸",
    "description": "Pythonì—ì„œ ì£¼ì„ì„ ì‘ì„±í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°í˜¸ëŠ”?",
    "problem_type": "multiple_choice",
    "problem_data": {
        "question": "Pythonì˜ ì£¼ì„ ê¸°í˜¸ëŠ”?",
        "choices": ["//", "#", "/*", "<!--"],
        "correct_answer": "#"
    },
    "difficulty": "easy",
    "is_boss_problem": false,
    "order": 1,
    "initial_code": "",
    "time_limit": 2,
    "memory_limit": 128,
    "exp_reward": 10,
    "coin_reward": 5,
    "needs_judge0": false,
    "is_trial": true,
    "is_immediate_retry": false,
    "created_at": "2025-11-01T10:00:00Z"
}


================================================================================
âš ï¸ ì£¼ì˜ì‚¬í•­
================================================================================

[1. ë©”ì„œë“œ ìë™ ì‹¤í–‰ ì•ˆ ë¨]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ needs_judge0(), is_trial_problem(), is_immediate_retry()
âš ï¸ ëª¨ë‘ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•¨!


[2. problem_data êµ¬ì¡°]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ ë¬¸ì œ íƒ€ì…ë§ˆë‹¤ ë‹¤ë¥¸ êµ¬ì¡°
âš ï¸ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œê°€ ë™ì¼í•œ êµ¬ì¡° ê³µìœ  í•„ìš”
âš ï¸ ë¬¸ì„œí™” í•„ìˆ˜!


[3. ì •ë‹µ ì €ì¥ ìœ„ì¹˜]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ê°ê´€ì‹/ë‹¨ì–´ ì„ íƒ: problem_dataì— ì €ì¥
ì½”ë”© ë¬¸ì œ: test_casesë¡œ ê´€ë¦¬


[4. CASCADE ì‚­ì œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Problem ì‚­ì œ ì‹œ ê´€ë ¨ ë°ì´í„° ì‚­ì œ:
âœ— TestCase
âœ— ProblemAttempt
âœ— UserReviewList


================================================================================
ğŸ“ ë°ì´í„° ì˜ˆì‹œ
================================================================================

[ë ˆìŠ¨ 1: ë³€ìˆ˜ ì„ ì–¸í•˜ê¸° - ë¬¸ì œ ìƒ˜í”Œ]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ë¬¸ì œ 1 (ê°ê´€ì‹): Pythonì˜ ì£¼ì„ ê¸°í˜¸
ë¬¸ì œ 2 (ë‹¨ì–´ ì„ íƒ): for ë°˜ë³µë¬¸ ë¹ˆì¹¸ ì±„ìš°ê¸°
ë¬¸ì œ 3 (ì½”ë”©): ë³€ìˆ˜ì— ê°’ ì €ì¥í•˜ê¸°
ë¬¸ì œ 4 (ì½”ë”©): ë‘ ë³€ìˆ˜ì˜ í•© ì¶œë ¥
ë¬¸ì œ 5 (ë³´ìŠ¤ ì½”ë”©): ì„¸ ë³€ìˆ˜ì˜ í‰ê·  ê³„ì‚° ğŸ‘‘


================================================================================
ğŸ”— ê´€ë ¨ ëª¨ë¸ ë§í¬
================================================================================

â†’ Lesson: ë ˆìŠ¨ ì •ë³´
â†’ TestCase: ì½”ë”© ë¬¸ì œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
â†’ ProblemAttempt: ë¬¸ì œ ì‹œë„ ê¸°ë¡
â†’ UserReviewList: ë³µìŠµ ë¦¬ìŠ¤íŠ¸


================================================================================
ë!
================================================================================
